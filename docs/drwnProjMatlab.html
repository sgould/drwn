<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Darwin: Matlab Interfaces</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="drwn.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Darwin
   &#160;<span id="projectnumber">1.10(beta)</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Matlab Interfaces </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The <b>matlab</b> project implements <code>mex</code> interfaces to various components of the <b>Darwin</b> library. A number of Matlab scripts (in <code>src/scripts</code>) also facilitate interoperating with <b>Darwin</b> from Matlab. The Matlab routines are:</p>
<ul>
<li><code>mexAnalyseClassifier</code> : analyse the performance of a classifier </li>
<li><code>mexDarwinTest</code> : test <b>Darwin</b> libraries from Matlab </li>
<li><code>mexEvalClassifier</code> : run a previously trained classifier on some new data </li>
<li><code>mexFactorGraphInference</code> : perform graphical model inference </li>
<li><code>mexImageCRF</code> : perform CRF-based pixel labeling on an image </li>
<li><code>mexKMeans</code> : run (weighted) k-means on a given dataset </li>
<li><code>mexLearnClassifier</code> : learn a classifier from training data </li>
<li><code>mexLoadSuperpixels</code> : loads superpixels from a previously saved <a class="el" href="classdrwnSuperpixelContainer.html" title="Holds multiple oversegmentations for a given image. ">drwnSuperpixelContainer</a> object </li>
<li><code>mexMaxFlow</code> : find the maximum flow through a weighted directed graph </li>
<li><code>mexQPSolver</code> : solve a quadratic program using <b>Darwin's</b> QP solver </li>
<li><code>mexSaveSuperpixels</code> : saves superpixels to a <a class="el" href="classdrwnSuperpixelContainer.html" title="Holds multiple oversegmentations for a given image. ">drwnSuperpixelContainer</a> object </li>
<li><code>mexLoadPatchMatchGraph</code> : load a <a class="el" href="classdrwnPatchMatchGraph.html" title="Each image maintains a W-by-H-by-K array of match records referencing the (approximate) best K matche...">drwnPatchMatchGraph</a> object (see <a class="el" href="drwnProjPatchMatch.html">PatchMatchGraph Project</a>)</li>
</ul>
<ul>
<li><code>drwnCombineImages</code> : combines multiple images into a single big image </li>
<li><code>drwnLoadDataset</code> : loads a <a class="el" href="classdrwnDataset.html" title="Implements a cacheable dataset containing feature vectors, labels and optional weights. ">drwnDataset</a> object </li>
<li><code>drwnSaveDataset</code> : saves a <a class="el" href="classdrwnDataset.html" title="Implements a cacheable dataset containing feature vectors, labels and optional weights. ">drwnDataset</a> object</li>
</ul>
<p>The remainder of this document describes how to compile the <code>mex</code> interfaces and provides some example uses. Pre-compiled <code>mex</code> files can be downloaded from <a class="el" href="drwnDownloadsDoc.html#drwnCodeDownload">Code Downloads</a>. Additional examples can be found in the <code>projects/matlab/examples</code> directory.</p>
<h1><a class="anchor" id="drwnProjMatlabInstall"></a>
Compiling Mex Projects</h1>
<h2><a class="anchor" id="drwnProjMatlabInstallLinux"></a>
Linux</h2>
<ul>
<li>build the <b>Darwin</b> libraries (<a class="el" href="linuxInstall.html#linuxCodeBuild">Building the Code</a>) </li>
<li>create a symbolic link to matlab in the <code>external</code> directory, e.g., <div class="fragment"><div class="line">ln -s /usr/<a class="code" href="namespacedrwnNNGraphMoves.html#a14c718ac3f3c9c68c16f9877c3c4a308">local</a>/MATLAB/R2015b/ external/matlab</div></div><!-- fragment --> </li>
<li>type <code>"make drwnprojs"</code> </li>
<li>alternatively, start Matlab, change to the <code>projects/matlab</code> directory and execute <code>buildLinux</code> </li>
</ul>
<dl class="section warning"><dt>Warning</dt><dd>On the latest versions of Ubuntu and older versions of Matlab you may get compiler warnings complaining about gcc version incompatibility. This can be fixed by replacing libstdc++.so.6 and libgcc_s.so.1 in the Matlab library directory, e.g., <div class="fragment"><div class="line">cd external/matlab/sys/os/glnx86</div><div class="line">rm libstdc++*</div><div class="line">rm libgcc*</div><div class="line">ln -s /usr/lib/i386-linux-gnu/libstdc++.so.6</div><div class="line">ln -s /usr/lib/i386-linux-gnu/libgcc_s.so.1</div></div><!-- fragment --> You may need to execute these commands with superuser (<code>sudo</code>) privileges.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>If you are having problems running Matlab with OpenCV, try starting Matlab with <div class="fragment"><div class="line">LD_PRELOAD=/usr/lib/x86_64-linux-gnu/libfreetype.so.6 matlab &amp;</div></div><!-- fragment --></dd></dl>
<h2><a class="anchor" id="drwnProjMatlabInstallWindows"></a>
Windows</h2>
<ul>
<li>compile the <b>Darwin</b> libraries in Release Mode </li>
<li>start Matlab </li>
<li>configure the mex compiler (<code>"mex -setup"</code>) </li>
<li>change to the <code>projects\matlab</code> directory </li>
<li>execute <code>buildWindows</code> </li>
</ul>
<dl class="section warning"><dt>Warning</dt><dd>Make sure you have compiled the <b>Darwin</b> libraries for the correct architecture. For example, if you are running 64-bit Matlab then you will need to compile the <b>Darwin</b> libraries using the x64 configuration.</dd></dl>
<h2><a class="anchor" id="drwnProjMatlabInstallMacOSX"></a>
Mac OS X</h2>
<ul>
<li>build the <b>Darwin</b> libraries (<a class="el" href="osxInstall.html#osxCodeBuild">Building the Code</a>) </li>
<li>create a symbolic link to matlab in the <code>external</code> directory, e.g., <div class="fragment"><div class="line">ln -s /Applications/MATLAB_R2014a.app/ external/matlab</div></div><!-- fragment --> </li>
<li>type <code>"make drwnprojs"</code> </li>
<li>alternatively, start Matlab, change to the <code>projects/matlab</code> directory and execute <code>buildMacOSX</code> </li>
</ul>
<h1><a class="anchor" id="drwnProjMatlabExamples"></a>
Examples</h1>
<h2><a class="anchor" id="drwnProjMatlabExampleClassifier"></a>
Multi-class Classification</h2>
<p>The full suite of <b>Darwin</b> classifiers can be trained and evaluated from Matlab. The following example shows how to train a multi-class logistic classifier (<a class="el" href="group__drwnConfigSettings.html#drwnMultiClassLogistic">drwnMultiClassLogistic</a>) and then evaluate it (on the training set!).</p>
<div class="fragment"><div class="line">% <a class="code" href="drwnXMLUtils_8h.html#a2fca02d61876cbdab6c38edcf34a285d">load</a> iris dataset</div><div class="line">[x, y] = iris_dataset;</div><div class="line">x = x<span class="stringliteral">&#39;; y = ([0, 1, 2] * y)&#39;</span>;</div><div class="line"></div><div class="line">% learn a classifier</div><div class="line">options = <span class="keyword">struct</span>(<span class="stringliteral">&#39;verbose&#39;</span>, 1, <span class="stringliteral">&#39;method&#39;</span>, <span class="stringliteral">&#39;drwnMultiClassLogistic&#39;</span>);</div><div class="line">classifier = mexLearnClassifier(x, y, [], options);</div><div class="line"></div><div class="line">% evaluate classifier (on training data)</div><div class="line">options = <span class="keyword">struct</span>(<span class="stringliteral">&#39;verbose&#39;</span>, 1);</div><div class="line">[predictions, scores] = mexEvalClassifier(classifier, x, options);</div><div class="line"></div><div class="line">accuracy = <a class="code" href="drwnStatsUtils_8h.html#ae8c871c7f158ad280bc3ec118ebf8c24">sum</a>(predictions == y)</div></div><!-- fragment --><p>The classifier is stored as an XML string and can be saved for later use. Sometimes it is useful to weight the training examples differently, e.g., so that every class contributes the same mass to the classifier. The following code snippet shows an example:</p>
<div class="fragment"><div class="line">% weight training examples</div><div class="line">numClasses = max(y) + 1;</div><div class="line">w = zeros(size(y));</div><div class="line"><span class="keywordflow">for</span> k = 1:numClasses,</div><div class="line">    indx = find(y == k - 1);</div><div class="line">    w(indx) = 1.0 / length(indx);</div><div class="line">end;</div><div class="line"></div><div class="line">% learn a classifier</div><div class="line">options = <span class="keyword">struct</span>(<span class="stringliteral">&#39;verbose&#39;</span>, 1, <span class="stringliteral">&#39;method&#39;</span>, <span class="stringliteral">&#39;drwnMultiClassLogistic&#39;</span>);</div><div class="line">classifier = mexLearnClassifier(x, y, w, options);</div></div><!-- fragment --><dl class="section warning"><dt>Warning</dt><dd>In <b>Darwin</b> classes are labeled from 0 to K-1. A negative class means  unknown and is ignored during training.</dd></dl>
<p>Sometimes it helps to normalize features to have zero mean and unit variance before training classifiers. You can do this automatically using the <code>'whiten'</code> option. The normalization parameters are stored with the classifier and will be applied automatically when invoking the the <code>mexEvaluateClassifier</code> function.</p>
<p>If instead of learning a multi-class logistic classifier (<a class="el" href="group__drwnConfigSettings.html#drwnMultiClassLogistic">drwnMultiClassLogistic</a>) you want to learn a decision tree classifier (<a class="el" href="group__drwnConfigSettings.html#drwnDecisionTree">drwnDecisionTree</a>) you can simply change the <code>'method'</code> option. The <code>'set'</code> option allows you to configure the internal parameters of the decision tree as the following code snippet shows:</p>
<div class="fragment"><div class="line">% learn a decision tree classifier</div><div class="line">options = <span class="keyword">struct</span>(<span class="stringliteral">&#39;verbose&#39;</span>, 1, <span class="stringliteral">&#39;method&#39;</span>, <span class="stringliteral">&#39;drwnDecisionTree&#39;</span>, ...</div><div class="line">    <span class="stringliteral">&#39;set&#39;</span>, <span class="stringliteral">&#39;drwnDecisionTree maxDepth 5&#39;</span>);</div><div class="line">classifier = mexLearnClassifier(x, y, [], options);</div></div><!-- fragment --><h2><a class="anchor" id="drwnProjMatlabExampleInference"></a>
Graphical Model MAP Inference</h2>
<p>In order to perform inference in a graphical model we need to define the universe of variables and a factor graph over which inference will be performed. The universe is defined by a vector specifying the cardinality of each variable. For example,</p>
<div class="fragment"><div class="line">universe = [3, 2, 2];</div></div><!-- fragment --><p>Defines a universe over three random variables, say, A, B, and C. The first random variable, A, is ternary, while the remaining two are binary.</p>
<p>Next we need to define a factor graph, which is a structure array that specifies the set of variables in each factor and the value of the factor for every possible assignment to it's variables. The following provides an example factor graph with two (random) factors defined over variables (A, B) and (B, C), respectively.</p>
<div class="fragment"><div class="line">factors = [];</div><div class="line">factors(1).vars = [0 1];</div><div class="line">factors(1).data = rand(prod(universe([1 2])), 1);</div><div class="line">factors(2).vars = [1 2];</div><div class="line">factors(2).data = rand(prod(universe([2 3])), 1);</div></div><!-- fragment --><p>This defines the energy function <img class="formulaInl" alt="$E(A, B, C) = \psi_1(A, B) + \psi_2(B, C)$" src="form_68.png"/>. <b>Darwin</b> will try to minimize this energy function during inference.</p>
<dl class="section warning"><dt>Warning</dt><dd>In <b>Darwin</b> indexes are 0-based, while in Matlab they are 1-based. The first variable has id 0.</dd></dl>
<p>We can now run inference (energy minimization) over the factor graph. For example, to run max-product inference and display the resulting MAP assignment we have</p>
<div class="fragment"><div class="line">options = <span class="keyword">struct</span>(<span class="stringliteral">&#39;verbose&#39;</span>, 1, <span class="stringliteral">&#39;method&#39;</span>, <span class="stringliteral">&#39;drwnMaxProdInference&#39;</span>);</div><div class="line">assignment = mexFactorGraphInference(universe, factors, [], options);</div><div class="line">disp(assignment);</div></div><!-- fragment --><p>Suppose that we wish to implement a Markov chain over variables <img class="formulaInl" alt="$X_1$" src="form_69.png"/> to <img class="formulaInl" alt="$X_n$" src="form_70.png"/> where we want the labels in the chain to be monotonically non-decreasing. The following code shows how this can be achieved.</p>
<div class="fragment"><div class="line">N = 10; % length of chain</div><div class="line">L = 5;  % label space</div><div class="line"></div><div class="line">universe = repmat(L, N, 1);</div><div class="line">factors = [];</div><div class="line"><span class="keywordflow">for</span> i=1:N,</div><div class="line">    factors(end + 1).vars = i - 1;</div><div class="line">    factors(end).data = rand(L, 1);</div><div class="line">end;</div><div class="line"></div><div class="line">pairwiseCost = tril(1000 * (ones(L, L) - eye(L, L)));</div><div class="line"><span class="keywordflow">for</span> i = 1:N - 1,</div><div class="line">    factors(end + 1).vars = [i - 1, i];</div><div class="line">    factors(end).data = pairwiseCost(:); </div><div class="line">end;</div><div class="line"></div><div class="line">edges = [0:N-2, 1:N-1; N:2*N-2, N:2*N-2]<span class="stringliteral">&#39;;</span></div><div class="line"><span class="stringliteral"></span></div><div class="line"><span class="stringliteral">options = struct(&#39;</span>verbose<span class="stringliteral">&#39;, 1, &#39;</span>method<span class="stringliteral">&#39;, &#39;</span><a class="code" href="classdrwnMaxProdInference.html">drwnMaxProdInference</a><span class="stringliteral">&#39;);</span></div><div class="line"><span class="stringliteral">assignment = mexFactorGraphInference(universe, factors, edges, options);</span></div></div><!-- fragment --><h2><a class="anchor" id="drwnProjMatlabExampleMaxFlow"></a>
Max-Flow/Min-Cut</h2>
<p>The <code>mexMaxFlow</code> function provides code for computing the minimum-cut in a directed weighted graph (see <a class="el" href="group__drwnPGM.html#drwnMaxFlowDoc">Max-flow/Min-cut</a>).</p>
<p>The following example shows how to find the value of the minimum cut on a simple graph from Matlab.</p>
<div class="dotgraph">
</div>
<div class="fragment"><div class="line">% define edges</div><div class="line">edgeList = [</div><div class="line">    -1  0  3;  % SOURCE -&gt; 0</div><div class="line">    -1  2  3;  % SOURCE -&gt; 2</div><div class="line">     0  1  4;  % 0 -&gt; 1</div><div class="line">     1  2  1;  % 1 -&gt; 2</div><div class="line">     1  3  2;  % 1 -&gt; 3</div><div class="line">     2  3  2;  % 2 -&gt; 3</div><div class="line">     2  4  6;  % 2 -&gt; 4</div><div class="line">     3 -1  1;  % 3 -&gt; TARGET</div><div class="line">     4 -1  9;  % 4 -&gt; TARGET</div><div class="line">];</div><div class="line"></div><div class="line">% run max-flow</div><div class="line">[value] = mexMaxFlow(edgeList);</div><div class="line"></div><div class="line">disp([<span class="stringliteral">&#39;Value of minimum cut is &#39;</span>, num2str(value)]);</div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>A negative value indicates a source or target edge. Node indexing is 0-based.</dd></dl>
<h2><a class="anchor" id="drwnProjMatlabExampleKMeans"></a>
k-Means</h2>
<p>The <code>mexKMeans</code> function provides and interface to <b>Darwin's</b> fast k-means code. An example usage is given below.</p>
<div class="fragment"><div class="line">% <span class="keyword">get</span> the data (rowwise features)</div><div class="line">x = generateFeatureVectors();</div><div class="line"></div><div class="line">% run k-means</div><div class="line">options = <span class="keyword">struct</span>(<span class="stringliteral">&#39;verbose&#39;</span>, 1, <span class="stringliteral">&#39;maxiters&#39;</span>, 100);</div><div class="line">centroids = mexKMeans(5, x, [], options);</div><div class="line"></div><div class="line">% plot results (first two dimensions)</div><div class="line">figure;</div><div class="line">plot(x(:, 1), x(:, 2), <span class="stringliteral">&#39;b.&#39;</span>);</div><div class="line">hold on;</div><div class="line">plot(centroids(:, 1), centroids(:, 2), <span class="stringliteral">&#39;rx&#39;</span>, <span class="stringliteral">&#39;MarkerSize&#39;</span>, 5, <span class="stringliteral">&#39;LineWidth&#39;</span>, 2);</div><div class="line">hold off;</div><div class="line">title(<span class="stringliteral">&#39;Darwin k-Means Example&#39;</span>);</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed May 7 2025 11:32:27 for Darwin by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
