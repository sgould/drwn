<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Darwin: drwnBase</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="drwn.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Darwin
   &#160;<span id="projectnumber">1.10(beta)</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">drwnBase<div class="ingroups"><a class="el" href="group__drwnLibraries.html">Darwin Libraries</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<h1><a class="anchor" id="drwnBaseDef"></a>
Class List for drwnBase</h1>
<ul>
<li><a class="el" href="classdrwnBitArray.html" title="Implements an efficient packed array of bits. ">drwnBitArray</a> : Implements an efficient packed array of bits. </li>
<li><a class="el" href="classdrwnCodeProfiler.html" title="Static class for providing profile information on functions. ">drwnCodeProfiler</a> : Static class for providing profile information on functions. </li>
<li><a class="el" href="drwnCommandLine_8h.html#drwnCommandLine">drwnCommandLine</a> : Command line processing macros. Applications should use these macros to present a consistent interface. </li>
<li><a class="el" href="drwnCompatibility_8h.html#drwnCompatibility">drwnCompatibility</a> : Windows/linux compatibility layer. </li>
<li><a class="el" href="classdrwnConfigurableModule.html" title="Interface for a configurable module. ">drwnConfigurableModule</a> : Interface for a configurable module. </li>
<li><a class="el" href="classdrwnConfigurationManager.html" title="Configuration manager. ">drwnConfigurationManager</a> : Configuration manager. </li>
<li><a class="el" href="drwnConstants_8h.html#drwnConstants">drwnConstants</a> : Provides useful constants and version information. </li>
<li><a class="el" href="classdrwnFactory.html">drwnFactory</a> : Templated factory for creating or cloning objects for a particular base class. </li>
<li><a class="el" href="drwnFileUtils_8h.html#drwnFileUtils">drwnFileUtils</a> : File and directory processing utilities. </li>
<li><a class="el" href="classdrwnIndexQueue.html" title="Provides a queue datastructure on a fixed number of indexes. At most one copy of each index can appea...">drwnIndexQueue</a> : Provides a queue datastructure on a fixed number of indexes. At most one copy of each index can appear in the queue (a second enqueue is ignored). Membership of the queue can be queried. </li>
<li><a class="el" href="classdrwnLogger.html" title="Message and error logging. This class is not thread-safe in the interest of not having to flush the l...">drwnLogger</a> : Message and error logging. This class is not thread-safe in the interest of not having to flush the log on every message. </li>
<li><a class="el" href="classdrwnOrderedMap.html" title="Provides a datastructure for that can be indexed by a KeyType (usually a string) or unsigned integer...">drwnOrderedMap</a> : Provides a datastructure for that can be indexed by a <code>KeyType</code> (usually a string) or unsigned integer, i.e., the index. </li>
<li><a class="el" href="classdrwnProperties.html" title="Provides an abstract interface for dynamic properties. ">drwnProperties</a> : Provides an abstract interface for dynamic properties. </li>
<li><a class="el" href="classdrwnSmartPointer.html" title="Implements a shared pointer interface to avoid the need to deep copy constant (shared) objects...">drwnSmartPointer</a> : Implements a shared pointer interface to avoid the need to deep copy constant (shared) objects. </li>
<li><a class="el" href="drwnStatsUtils_8h.html#drwnStatsUtils">drwnStatsUtils</a> : Generic statistical utilities. </li>
<li><a class="el" href="classdrwnStdObjIface.html" title="standard Darwin object interface (cloneable and writeable) ">drwnStdObjIface</a> : standard Darwin object interface (cloneable and writeable) </li>
<li><a class="el" href="drwnStrUtils_8h.html#drwnStrUtils">drwnStrUtils</a> : Generic string utilities. </li>
<li><a class="el" href="classdrwnThreadJob.html" title="Interface for a thread job functor. ">drwnThreadJob</a> : Interface for a thread job functor. </li>
<li><a class="el" href="classdrwnThreadPool.html" title="Implements a pool of threads for running concurrent jobs. ">drwnThreadPool</a> : Implements a pool of threads for running concurrent jobs. </li>
<li><a class="el" href="classdrwnTriplet.html" title="Basic datatype for holding three objects of arbitrary type. Similar to the STL pair&lt;&gt; class...">drwnTriplet</a> : Basic datatype for holding three objects of arbitrary type. Similar to the STL pair&lt;&gt; class. </li>
<li><a class="el" href="drwnXMLParser_8h.html#drwnXMLParser">drwnXMLParser</a> : Provides XML parsing functionality for serializing and deserializing objects and containers of objects. </li>
<li><a class="el" href="drwnXMLUtils_8h.html">drwnXMLUtils</a> : Provides utility functions for XML parsing.</li>
</ul>
<h1><a class="anchor" id="drwnConfigManagerDoc"></a>
Configuration Manager</h1>
<p>For many research projects it is useful to have a standard configuration for running experiments with only a few parameters changing from one experiment to the next. <b>Darwin</b> supports this through two main mechanisms&mdash;XML configuration and command line options. The general strategy is to create an XML file with the standard configuration and then provide overrides for various settings on the command line. The system is lightweight while still catering for most configuration needs. An example XML configuration file is shown below.</p>
<div class="fragment"><div class="line">&lt;<a class="code" href="namespacedrwn.html">drwn</a>&gt;</div><div class="line">  &lt;<a class="code" href="classdrwnCodeProfiler.html">drwnCodeProfiler</a>    enabled=<span class="stringliteral">&quot;false&quot;</span> /&gt;</div><div class="line">  &lt;<a class="code" href="classdrwnLogger.html">drwnLogger</a>          logLevel=<span class="stringliteral">&quot;message&quot;</span></div><div class="line">                       logFile=<span class="stringliteral">&quot;&quot;</span> /&gt;</div><div class="line">  &lt;<a class="code" href="classdrwnThreadPool.html">drwnThreadPool</a>      threads=<span class="stringliteral">&quot;8&quot;</span> /&gt;</div><div class="line">  &lt;<a class="code" href="classdrwnConfusionMatrix.html">drwnConfusionMatrix</a> colSep=<span class="stringliteral">&quot;&amp;#9;&quot;</span></div><div class="line">                       rowBegin=<span class="stringliteral">&quot;&amp;#9;&quot;</span></div><div class="line">                       rowEnd=<span class="stringliteral">&quot;&quot;</span>&gt;</div><div class="line">  &lt;myApplication       attributeName=``attributevalue<span class="stringliteral">&#39;&#39;</span>/&gt;</div><div class="line">    &lt;myArbitraryData&gt;</div><div class="line">      1 2 3 4</div><div class="line">    &lt;/myArbitraryData&gt;</div><div class="line">  &lt;/myApplication&gt;</div><div class="line">&lt;/<a class="code" href="namespacedrwn.html">drwn</a>&gt;</div></div><!-- fragment --><p>The <a class="el" href="classdrwnConfigurationManager.html">drwnConfigurationManager</a> class handles configuration of static parameters for <b>Darwin</b> libraries and can be used for configuring individual applications or projects. The command line options <b>-config</b> and <b>-set</b> will automatically invoke the configuration manager. To invoke it manually you can simply call the <a class="el" href="classdrwnConfigurationManager.html#acc2508c011057f4787aaafb9c1013e78">drwnConfigurationManager::configure</a> function.</p>
<p>Standard configuration parameters are defined by the triplet: module, name and value. In the XML configuration file shown above the tags "drwnCodeProfiler", "drwnConfusionMatrix", etc. define the module (i.e., configurable class) and the node's attributes define the name-value pairs. An application can define its own module (XML node) with arbitrary name-value pairs. The structure of the application-specific XML node can be arbitrary and it is up to the application developer to parse non-attribute content (such as the <code>myArbitraryData</code> node in the example above). The <b>-set</b> command line option can only be used for name-value pairs.</p>
<p>To register a configurable class with the <b>Darwin</b> Configuration Manager, an application needs to create a derived class from base <a class="el" href="classdrwnConfigurableModule.html" title="Interface for a configurable module. ">drwnConfigurableModule</a> and override the setConfiguration function. More control can be achieved by also overriding the readConfiguration function.</p>
<p>To register the class, the code simply needs to instantiate a global class member&mdash;the <a class="el" href="classdrwnConfigurableModule.html" title="Interface for a configurable module. ">drwnConfigurableModule</a> constructor will handle registration.</p>
<p>An example is the drwnMultiClassLogistic configuration module which is placed inside the drwnMultiClassLogistic.cpp file:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span><a class="code" href="classdrwnMultiClassLogisticConfig.html">drwnMultiClassLogisticConfig</a> : <span class="keyword">public</span> <a class="code" href="classdrwnConfigurableModule.html">drwnConfigurableModule</a> {</div><div class="line"><span class="keyword">public</span>:</div><div class="line">  <a class="code" href="classdrwnMultiClassLogisticConfig.html">drwnMultiClassLogisticConfig</a>() : <a class="code" href="classdrwnConfigurableModule.html">drwnConfigurableModule</a>(<span class="stringliteral">&quot;drwnMultiClassLogistic&quot;</span>) { }</div><div class="line">  ~<a class="code" href="classdrwnMultiClassLogisticConfig.html">drwnMultiClassLogisticConfig</a>() { }</div><div class="line"></div><div class="line">  <span class="keywordtype">void</span> usage(ostream &amp;os)<span class="keyword"> const </span>{</div><div class="line">    os &lt;&lt; <span class="stringliteral">&quot;      lambda        :: regularization strength (default: &quot;</span></div><div class="line">       &lt;&lt; <a class="code" href="classdrwnMultiClassLogisticBase.html#abec443f5f89570315fadbac5dfc9b137">drwnMultiClassLogistic::REG_STRENGTH</a> &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div><div class="line">    os &lt;&lt; <span class="stringliteral">&quot;      maxIterations :: maximum number of training iterations (default: &quot;</span></div><div class="line">       &lt;&lt; <a class="code" href="classdrwnMultiClassLogisticBase.html#aa2087e2148491bae833649248b28ab6f">drwnMultiClassLogistic::MAX_ITERATIONS</a> &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keywordtype">void</span> setConfiguration(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keyword">const</span> <span class="keywordtype">char</span> *value) {</div><div class="line">    <span class="keywordflow">if</span> (!strcmp(name, <span class="stringliteral">&quot;lambda&quot;</span>)) {</div><div class="line">      <a class="code" href="classdrwnMultiClassLogisticBase.html#abec443f5f89570315fadbac5dfc9b137">drwnMultiClassLogistic::REG_STRENGTH</a> = std::max(0.0, atof(value));</div><div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(name, <span class="stringliteral">&quot;maxIterations&quot;</span>)) {</div><div class="line">      <a class="code" href="classdrwnMultiClassLogisticBase.html#aa2087e2148491bae833649248b28ab6f">drwnMultiClassLogistic::MAX_ITERATIONS</a> = std::max(0, atoi(value));</div><div class="line">    } <span class="keywordflow">else</span> {</div><div class="line">      DRWN_LOG_FATAL(<span class="stringliteral">&quot;unrecognized configuration option &quot;</span> &lt;&lt; name &lt;&lt; <span class="stringliteral">&quot; for &quot;</span> &lt;&lt; this-&gt;name());</div><div class="line">    }</div><div class="line">  }</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">static</span> <a class="code" href="classdrwnMultiClassLogisticConfig.html">drwnMultiClassLogisticConfig</a> gMultiClassLogisticConfig;</div></div><!-- fragment --><p>Use <b>-config</b> on the command line by itself to get online help for most configurable modules. You can also use <b>-set</b> by itself to get a list of registered modules, or <b>"-set &lt;module&gt;"</b> to get online help for a specific module.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__drwnConfigSettings.html">Configuration Settings</a></dd></dl>
<h1><a class="anchor" id="drwnLoggerDoc"></a>
Messages, Warnings and Errors</h1>
<p>Messages, warnings and errors are managed via the <a class="el" href="classdrwnLogger.html" title="Message and error logging. This class is not thread-safe in the interest of not having to flush the l...">drwnLogger</a> class. The <code>DRWN_LOG</code> macro will automatically write log messages to a file (if specified) and display them on the console. You can set the verbosity level to control which messages get displayed. The following macros generate messages at different verbosity levels:</p>
<center> <table border="1px" style="border-color:#cccccc; background-color: #f5f5f5; border-collapse:collapse;">
<tr>
<td><b>Macro</b></td><td><b>Display</b></td><td><b>Description</b>  </td></tr>
<tr>
<td>DRWN_LOG_FATAL</td><td><code>-*-</code></td><td>An unrecoverable error has occurred and the code will terminate.  </td></tr>
<tr>
<td>DRWN_LOG_ERROR</td><td><code>-E-</code></td><td>A recoverable error has occurred, e.g., a missing file.  </td></tr>
<tr>
<td>DRWN_LOG_WARNING</td><td><code>-W-</code></td><td>Something unexpected happened, e.g., a parameter is zero.  </td></tr>
<tr>
<td>DRWN_LOG_MESSAGE</td><td><code>&mdash;</code></td><td>Standard messages, e.g., application-level progress information.  </td></tr>
<tr>
<td>DRWN_LOG_STATUS</td><td><code>&mdash;</code></td><td>Status/progress messages, e.g., image names and sizes during loading.  </td></tr>
<tr>
<td>DRWN_LOG_VERBOSE</td><td><code>&mdash;</code></td><td>Verbose messages, e.g., intermediate performance results.  </td></tr>
<tr>
<td>DRWN_LOG_METRICS</td><td><code>&mdash;</code></td><td>Metrics messages, e.g., event statistics, etc.  </td></tr>
<tr>
<td>DRWN_LOG_DEBUG</td><td><code>-D-</code></td><td>Debugging messages, e.g., matrix inversion results, etc.  </td></tr>
</table>
</center><p>Other useful macros include <code>DRWN_LOG_PROGRESS_SPINNER</code>, which is useful to show activity within a loop and <code>DRWN_LOG_&lt;level&gt;_ONCE</code>, which will only log a message once (even if the code calling the message is run multiple times). The following code gives an example of each:</p>
<div class="fragment"><div class="line"><span class="preprocessor">  #include &quot;drwnBase.h&quot;</span></div><div class="line"></div><div class="line">  <span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]) {</div><div class="line">    <span class="comment">// standard command line processing</span></div><div class="line">    DRWN_BEGIN_CMDLINE_PROCESSING(argc, argv)</div><div class="line">    DRWN_END_CMDLINE_PROCESSING();</div><div class="line"></div><div class="line">    <span class="comment">// long running loop </span></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 1000; i++) {</div><div class="line">      DRWN_LOG_VERBOSE_ONCE(<span class="stringliteral">&quot;inside loop&quot;</span>);</div><div class="line">      DRWN_LOG_PROGRESS_SPINNER(<span class="stringliteral">&quot;processing...&quot;</span>);</div><div class="line">      sleep(1);  <span class="comment">// on Windows use Sleep(1000) in &lt;windows.h&gt;</span></div><div class="line">    }</div><div class="line">    </div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}    </div><div class="line"></div><div class="line">Applications can <span class="keyword">override</span> the message displaying functions by</div><div class="line">registering callbacks with the \ref <a class="code" href="classdrwnLogger.html">drwnLogger</a> <span class="keyword">class</span>. This is useful</div><div class="line"><span class="keywordflow">for</span> interfacing to Matlab or displaying errors in GUI dialog</div><div class="line">boxes. The following example registers a callback <span class="keywordflow">for</span> capturing errors</div><div class="line">and terminates <span class="keywordflow">if</span> too many errors occur.</div><div class="line"></div><div class="line">\code</div><div class="line"><span class="preprocessor">  #include &quot;drwnBase.h&quot;</span></div><div class="line"></div><div class="line">  <span class="keywordtype">void</span> errorMessageCallback(<span class="keyword">const</span> <span class="keywordtype">char</span> *msg) {</div><div class="line">    <span class="keyword">static</span> <span class="keywordtype">int</span> counter = 0;</div><div class="line">    std::cerr &lt;&lt; msg &lt;&lt; std::endl;</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (++counter &gt; 5) {</div><div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;too many error messages&quot;</span> &lt;&lt; std::endl;</div><div class="line">      exit(0);</div><div class="line">    }</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line">  {</div><div class="line">    <span class="comment">// set drwnLogger callbacks</span></div><div class="line">    <a class="code" href="classdrwnLogger.html#aae4179fafed3c60a04f845d1c686819c">drwnLogger::showErrorCallback</a> = errorMessageCallback;</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 10; i++) {</div><div class="line">      DRWN_LOG_ERROR(<span class="stringliteral">&quot;error message number &quot;</span> &lt;&lt; i);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">  }</div></div><!-- fragment --><p>The standard command line options <code>-quiet</code>, <code>-verbose</code>, and <code>-debug</code> allow you to filter which messages are produced (see <a class="el" href="group__drwnBase.html#drwnCommandLineDoc">Command Line Processing</a>).</p>
<h2><a class="anchor" id="secAsserts"></a>
Asserts</h2>
<p>Code written for the <b>Darwin</b> framework should use the <code>DRWN_ASSERT</code> or <code>DRWN_ASSERT_MSG</code> macros rather than the standard <code>assert</code> function to allow GUI applications and external environments, such as Matlab, to trap errors.</p>
<h1><a class="anchor" id="drwnCodeProfilerDoc"></a>
Code Profiling</h1>
<p><a class="el" href="classdrwnCodeProfiler.html" title="Static class for providing profile information on functions. ">drwnCodeProfiler</a> is typically used to accumulate information on entire functions (or within subroutines). Wrap the function or code block in </p><div class="fragment"><div class="line"><a class="code" href="classdrwnCodeProfiler.html#a06a266310b73c9ee20c4f36eeadd187e">drwnCodeProfiler::tic</a>(handle = getHandle(<span class="stringliteral">&quot;functionName&quot;</span>));</div><div class="line"><a class="code" href="classdrwnCodeProfiler.html#a12802783e9daf78891d1903b45930645">drwnCodeProfiler::toc</a>(handle);</div></div><!-- fragment --><p> to accumulate timing and number of calls for a given function. The timer accumulates the amount of processor and real (wall clock) time used between tic and toc calls (child processes, such as file I/O, are not counted in this time). Processor times may be inaccurate for functions that take longer than about 1 hour.</p>
<p>By default profiling is turned off and must be enabled in <b>main()</b> with </p><div class="fragment"><div class="line"><a class="code" href="classdrwnCodeProfiler.html#a0f35358482ad060b457b7c3248a6c801">drwnCodeProfiler::enabled</a> = <span class="keyword">true</span>;</div></div><!-- fragment --><p> Most <b>Darwin</b> applications use the standard command line option <b>-profile</b> to enable profiling. Call the function <code><a class="el" href="classdrwnCodeProfiler.html#a34621c90f72bbf2f0813f2100f0f3257" title="display profile information for all handles (to message logger) ">drwnCodeProfiler::print()</a></code> before exiting <b>main()</b> to log profiling information.</p>
<p>The code can also be used to setting time limits or recursive call limits within instrumented functions. Use time and calls to get the total running time or total number of calls for a given handle.</p>
<p>The macros <b>DRWN_FCN_TIC</b> and <b>DRWN_FCN_TOC</b> can be used at the entry and exit of your functions to instrument the entire function. Make sure you put <b>DRWN_FCN_TOC</b> <em>before</em> all <b>return</b> statements within the function.</p>
<dl class="section warning"><dt>Warning</dt><dd>Profiling provided by <a class="el" href="classdrwnCodeProfiler.html" title="Static class for providing profile information on functions. ">drwnCodeProfiler</a> should be used as an estimate only. Specifically it is not accurate for small functions. In those cases you are better off using <b>gprof</b> and the <b>"gcc -pg"</b> option or Microsoft's Visual C++ profiling software. Note also that instrumenting code for profiling will unavoidably add a small overhead to a function's running time, so do not use tic and toc within tight loops. Unlike compiling with <b>-pg</b> for <b>gprof</b>, functions tic and toc are <em>always</em> compiled into the code.</dd></dl>
<h1><a class="anchor" id="drwnCommandLineDoc"></a>
Command Line Processing</h1>
<p>Standard command line options for most <b>Darwin</b> applications are: </p><div class="fragment"><div class="line">-help             :: display application usage</div><div class="line">-config &lt;xml&gt;     :: configure Darwin from XML file (or without &lt;xml&gt; <span class="keywordflow">for</span> configuration help)</div><div class="line">-set &lt;m&gt; &lt;n&gt; &lt;v&gt;  :: set (configuration) &lt;m&gt;::&lt;n&gt; to value &lt;v&gt; (or -set &lt;m&gt; <span class="keywordflow">for</span> module help)</div><div class="line">-profile          :: profile code</div><div class="line">-quiet            :: only show warnings and errors</div><div class="line">-verbose          :: show verbose messages</div><div class="line">-debug            :: show debug messages</div><div class="line">-log &lt;filename&gt;   :: log filename</div><div class="line">-threads &lt;max&gt;    :: set maximum number of threads</div><div class="line">-randseed &lt;n&gt;     :: seed random number generators rand and drand48</div></div><!-- fragment --><p>Command line options are processed from left to right. If there are multiple conflicting options, the rightmost one will be taken, e.g., <code>"-threads 4 -threads 0"</code> will result in multi-threading being turned off. Many <b>Darwin</b> features can be configured using the <code>-config</code> or <code>-set</code> commandline options. The standard options provide shortcuts for these. For example, <code>"-verbose"</code> is equivalent to <code>"-set
drwnLogger logLevel VERBOSE"</code>.</p>
<p>Applications should include a <code>DRWN_BEGIN_CMDLINE_PROCESSING</code> block to automatically handle these options, e.g., </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[]) </div><div class="line">{</div><div class="line">     DRWN_BEGIN_CMDLINE_PROCESSING(argc, argv)</div><div class="line">     DRWN_END_CMDLINE_PROCESSING();</div><div class="line"></div><div class="line">     <span class="comment">// application code</span></div><div class="line"></div><div class="line">     <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><dl class="section see"><dt>See also</dt><dd><a class="el" href="drwnCommandLine_8h.html#drwnCommandLine">drwnCommandLine</a></dd></dl>
<h1><a class="anchor" id="drwnThreadPoolDoc"></a>
Thread Pool</h1>
<p>The threads read and execute jobs from a queue of arbitrary size. As soon as one of the <b>N</b> threads completes a job, it requests the next job in the queue, until the queue is empty, at which point it waits for a new job. The maximum number of threads is controlled by the <b>MAX_THREADS</b> static member variable. It can be set from the command line using the <b>-threads</b> option. Setting <b>MAX_THREADS</b> to zero will result in all jobs being executed in the main thread.</p>
<p>Derived classes should overload the <b>operator()()</b> member function. For example the following code creates a functor for computing the L2-norm of a vector:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>MySumSquaredJob : <span class="keyword">public</span> <a class="code" href="classdrwnThreadJob.html">drwnThreadJob</a> {</div><div class="line">  <span class="keyword">public</span>: </div><div class="line">    vector&lt;double&gt; data;</div><div class="line">    <span class="keywordtype">double</span> result;</div><div class="line">  <span class="keyword">public</span>:</div><div class="line">    MySumSquaredJob(<span class="keyword">const</span> vector&lt;double&gt;&amp; d) : data(d) { }</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> operator()() {</div><div class="line">      result = 0.0;</div><div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; data.size(); i++) {</div><div class="line">        result += data[i] * data[i];</div><div class="line">      }</div><div class="line">    }</div><div class="line">};</div></div><!-- fragment --><p>The lock and unlock methods should be used for controlling access to shared resources across threads (e.g., graphical output windows).</p>
<p>The following code demonstrates typical thread pool usage: </p><div class="fragment"><div class="line"><span class="comment">// start thread pool and add jobs</span></div><div class="line"><a class="code" href="classdrwnThreadPool.html">drwnThreadPool</a> threadPool;</div><div class="line">vector&lt;MySumSquaredJob *&gt; jobs;              <span class="comment">// derived from drwnThreadJob</span></div><div class="line"></div><div class="line">threadPool.<a class="code" href="classdrwnThreadPool.html#aaa917ff50e9058ab42d1f6f9fce2a5c3">start</a>();</div><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; numJobs; i++) {</div><div class="line">  vector&lt;double&gt; data = getDataForJob(i);    <span class="comment">// get the data for job i</span></div><div class="line">  jobs.push_back(<span class="keyword">new</span> MySumSquaredJob(data)); <span class="comment">// create functor for the job</span></div><div class="line">  threadPool.<a class="code" href="classdrwnThreadPool.html#ad9f4a771c0bf6a88360c014b94843881">addJob</a>(jobs.back());            <span class="comment">// add to job queue</span></div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// wait for jobs to finish (and show progress)</span></div><div class="line">threadPool.<a class="code" href="classdrwnThreadPool.html#a392cc344e00b729fe419be776f9f0fc8">finish</a>(<span class="keyword">true</span>);</div><div class="line"></div><div class="line"><span class="comment">// extract results (and delete jobs)</span></div><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; numJobs; i++) {</div><div class="line">  cerr &lt;&lt; <span class="stringliteral">&quot;||&quot;</span> &lt;&lt; <a class="code" href="drwnStrUtils_8h.html#a73ae7e986e8c63298610d330578f5b74">toString</a>(jobs[i]-&gt;data) &lt;&lt; <span class="stringliteral">&quot;|| = &quot;</span> &lt;&lt; jobs[i]-&gt;result &lt;&lt; endl;</div><div class="line">  <span class="keyword">delete</span> jobs[i];</div><div class="line">}  </div></div><!-- fragment --><h1><a class="anchor" id="drwnXMLUtilsDoc"></a>
XML Utilities</h1>
<p><b>Darwin</b> makes extensive use of XML formatting for serialization (saving) and de-serialization (loading) of objects. All objects derived from <a class="el" href="classdrwnWriteable.html" title="interface for objects that can serialize and de-serialize themselves ">drwnWriteable</a> implement methods for saving state to, and loading state from, an XML object.</p>
<p>A number of helper functions are provided in <a class="el" href="drwnXMLUtils_8h.html">drwnXMLUtils</a>. The following code snippet shows an example:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>MyObject {</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    VectorXd x;</div><div class="line"></div><div class="line">    MyObject() { <span class="comment">/* do nothing */</span> }</div><div class="line">    MyObject(<span class="keyword">const</span> VectorXd&amp; ix) : x(ix) { <span class="comment">/* do nothing */</span> }</div><div class="line">    ~MyObject() { <span class="comment">/* do nothing */</span> }</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> <a class="code" href="drwnXMLUtils_8h.html#a02bd9a573bfc57ca65f0c92e5656d3d4">save</a>(drwnXMLNode&amp; xml)<span class="keyword"> const </span>{ <a class="code" href="drwnXMLUtils_8h.html#ae0aa3b92b2395117bc2dc59a24dc7942">drwnXMLUtils::serialize</a>(xml, x); }</div><div class="line">    <span class="keywordtype">void</span> <a class="code" href="drwnXMLUtils_8h.html#a2fca02d61876cbdab6c38edcf34a285d">load</a>(drwnXMLNode&amp; xml) { <a class="code" href="drwnXMLUtils_8h.html#a113f4396097a6a1f15118f21e58c925a">drwnXMLUtils::deserialize</a>(xml, x); }</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() </div><div class="line">{</div><div class="line">    <span class="comment">// create a vector of MyObject</span></div><div class="line">    vector&lt;MyObject&gt; container;</div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 5; i++) {</div><div class="line">        container.push_back(MyObject(VectorXd::Random(5)));</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// save container to an XML file</span></div><div class="line">    <a class="code" href="drwnXMLUtils_8h.html#a6a883b13b61c8b6c5062a91b04e6dec7">drwnXMLUtils::write</a>(<span class="stringliteral">&quot;example.xml&quot;</span>, <span class="stringliteral">&quot;vector&quot;</span>, <span class="stringliteral">&quot;object&quot;</span>, container);</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="drwnFactoriesDoc"></a>
Factories</h1>
<p>Factories facilitate the creation of objects (derived from a specific base class) without having to know the specific object type at compile time. For example, <b>Dawrin</b> makes use of factories for creating or loading classifiers and feature transforms in the <a class="el" href="group__drwnML.html">drwnML</a> library.</p>
<p>Consider, for example, training either a decision tree classifier or a logistic regression classifier:</p>
<div class="fragment"><div class="line"><span class="comment">// load training dataset</span></div><div class="line"><a class="code" href="classdrwnDataset.html">drwnClassifierDataset</a> dataset;</div><div class="line">dataset.<a class="code" href="classdrwnDataset.html#aa1fdc4bb8dbbc5f9db9fd20337b027d8">read</a>(<span class="stringliteral">&quot;training_data.bin&quot;</span>);</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> nFeatures = dataset.<a class="code" href="classdrwnDataset.html#a9149f46735c9cf014f2cae2ee283e74b">numFeatures</a>();</div><div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> nClasses = dataset.<a class="code" href="classdrwnDataset.html#a857639f3c37241942b1ad5698aea8cec">maxTarget</a>() + 1;</div><div class="line"></div><div class="line"><span class="comment">// train and save the classifier</span></div><div class="line"><span class="keywordflow">if</span> (makeADecision()) {</div><div class="line">   <a class="code" href="classdrwnDecisionTree.html">drwnDecisionTree</a> model(nFeatures, nClasses);</div><div class="line">   model.<a class="code" href="classdrwnClassifier.html#a648e65d9e449aa4970699e304eb8c871">train</a>(dataset);</div><div class="line">   model.<a class="code" href="classdrwnWriteable.html#a8baade50e837398acc266c949de2d9a2">write</a>(<span class="stringliteral">&quot;classifier.xml&quot;</span>);</div><div class="line">} <span class="keywordflow">else</span> {</div><div class="line">   <a class="code" href="classdrwnTMultiClassLogistic.html">drwnMultiClassLogistic</a> model(nFeatures, nClasses);</div><div class="line">   model.<a class="code" href="classdrwnClassifier.html#a648e65d9e449aa4970699e304eb8c871">train</a>(dataset);</div><div class="line">   model.<a class="code" href="classdrwnWriteable.html#a8baade50e837398acc266c949de2d9a2">write</a>(<span class="stringliteral">&quot;classifier.xml&quot;</span>);</div><div class="line">}</div></div><!-- fragment --><p>Now in some other code we may want to use the classifier, but we don't know which classifier we trained. Factories to the rescue:</p>
<div class="fragment"><div class="line"><span class="comment">// load the classifier</span></div><div class="line"><a class="code" href="classdrwnClassifier.html">drwnClassifier</a> *classifier = <a class="code" href="classdrwnFactory.html#a5895a53d04ef8696ea81ecbacb22192d">drwnClassifierFactory::get</a>().createFromFile(<span class="stringliteral">&quot;classifier.xml&quot;</span>);</div><div class="line">DRWN_LOG_VERBOSE(<span class="stringliteral">&quot;loaded classifier of type &quot;</span> &lt;&lt; classifier-&gt;<a class="code" href="classdrwnTypeable.html#af25f284cb4b5d0e19001826975571ac2">type</a>());</div><div class="line"></div><div class="line"><span class="comment">// do something with the classifier</span></div><div class="line">...</div><div class="line"></div><div class="line"><span class="comment">// free the classifier</span></div><div class="line">delete classifier;</div></div><!-- fragment --><p>You can create factories for your own objects using the <a class="el" href="classdrwnFactory.html" title="Templated factory for creating or cloning objects for a particular base class. ">drwnFactory</a> template class. Here is a short example.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>myBase : <span class="keyword">public</span> <a class="code" href="classdrwnWriteable.html">drwnWriteable</a> {</div><div class="line">    ...</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">class </span>myDerivedA : <span class="keyword">public</span> myBase {</div><div class="line">   <span class="comment">// must define drwnWriteable interface</span></div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">class </span>myDerivedB : <span class="keyword">public</span> myBase {</div><div class="line">   <span class="comment">// must define drwnWriteable interface</span></div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;&gt;</div><div class="line"><span class="keyword">struct </span><a class="code" href="structdrwnFactoryTraits.html">drwnFactoryTraits</a>&lt;myBase&gt; {</div><div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> staticRegistration();</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <a class="code" href="classdrwnFactory.html">drwnFactory&lt;myBase&gt;</a> myBaseFactory;</div></div><!-- fragment --><p>The staticRegistration function is used to automatically tell the factory which classes belong to is. Otherwise you will need to explicitly add classes each time you use the factory with the registerClass function.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="structdrwnFactoryTraits.html">drwnFactoryTraits&lt;myBase&gt;::staticRegistration</a>()</div><div class="line">{</div><div class="line">    DRWN_FACTORY_REGISTER(myBase, myDerivedA);</div><div class="line">    DRWN_FACTORY_REGISTER(myBase, myDerivedB);</div><div class="line">}</div></div><!-- fragment --><p>We can now use the factory to create objects by name or from file.</p>
<div class="fragment"><div class="line">myBase *base;</div><div class="line">base = myBaseFactory::get().create(<span class="stringliteral">&quot;myDerivedA&quot;</span>);</div><div class="line">base-&gt;write(<span class="stringliteral">&quot;file.xml&quot;</span>);</div><div class="line"><span class="keyword">delete</span> base;</div><div class="line"></div><div class="line">base = myBaseFactory::get().createFromFile(<span class="stringliteral">&quot;file.xml&quot;</span>);</div><div class="line"><span class="keyword">delete</span> base;</div></div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed May 7 2025 11:32:27 for Darwin by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
