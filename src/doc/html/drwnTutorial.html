<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Darwin: Darwin Tutorial</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="drwn.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Darwin
   &#160;<span id="projectnumber">1.10(beta)</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Darwin Tutorial </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This tutorial is designed to give you a basic flavour for the design and use of the common features of the <b>Darwin</b> libraries. It assumes you are familiar with C++ and the Linux development environment.</p>
<p>The tutorial is divided into a number of parts, each exploring a different library within the <b>Darwin</b> framework. The parts are:</p>
<ul>
<li><a class="el" href="drwnTutorial.html#drwnTutorialHelloWorld">Hello World</a> </li>
<li><a class="el" href="drwnTutorial.html#drwnTutorialBase">Base and IO Libraries (drwnBase and drwnIO)</a> </li>
<li><a class="el" href="drwnTutorial.html#drwnTutorialML">Machine Learning Library (drwnML)</a> </li>
<li><a class="el" href="drwnTutorial.html#drwnTutorialPGM">Probablistic Graphical Models Library (drwnPGM)</a></li>
</ul>
<p>Source code for all the tutorials is included in the <code>projects/tutorial</code> directory.</p>
<h1><a class="anchor" id="drwnTutorialHelloWorld"></a>
Hello World</h1>
<p>This tutorial steps you through creating your first application using the <b>Darwin</b> framework under Linux&mdash;the application will simply print "hello world" using <b>Darwin's</b> logging system (see <a class="el" href="group__drwnBase.html#drwnLoggerDoc">Messages, Warnings and Errors</a>). It assumes that you have successfully downloaded and compiled the <b>Darwin</b> libraries (see <a class="el" href="index.html#drwnDownload">Downloading and Installing</a>). Throughout the tutorial we will assume that <code>$DARWIN</code> is the location (i.e., directory) where <b>Darwin</b> is installed.</p>
<h2><a class="anchor" id="drwnTutorialHelloWorld1"></a>
Create a Project Directory</h2>
<div class="fragment"><div class="line">mkdir helloworld</div><div class="line">cd helloworld</div></div><!-- fragment --><h2><a class="anchor" id="drwnTutorialHelloWorld2"></a>
Create the Application</h2>
<p>Create a file called <code>helloworld.cpp</code> containing the following code:</p>
<div class="fragment"><div class="line"><span class="comment">// c++ standard headers</span></div><div class="line"><span class="preprocessor">#include &lt;cstdlib&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;cstdio&gt;</span></div><div class="line"></div><div class="line"><span class="comment">// darwin library headers</span></div><div class="line"><span class="preprocessor">#include &quot;drwnBase.h&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacestd.html">std</a>;</div><div class="line"></div><div class="line"><span class="comment">// usage ---------------------------------------------------------------------</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> usage()</div><div class="line">{</div><div class="line">    cerr &lt;&lt; DRWN_USAGE_HEADER &lt;&lt; endl;</div><div class="line">    cerr &lt;&lt; <span class="stringliteral">&quot;USAGE: ./helloworld [OPTIONS]\n&quot;</span>;</div><div class="line">    cerr &lt;&lt; <span class="stringliteral">&quot;OPTIONS:\n&quot;</span></div><div class="line">         &lt;&lt; DRWN_STANDARD_OPTIONS_USAGE</div><div class="line">         &lt;&lt; endl;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// main ----------------------------------------------------------------------</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line">{</div><div class="line">    <span class="comment">// process commandline arguments</span></div><div class="line">    DRWN_BEGIN_CMDLINE_PROCESSING(argc, argv)</div><div class="line">    DRWN_END_CMDLINE_PROCESSING(usage());</div><div class="line"></div><div class="line">    <span class="comment">// print hello world and exit</span></div><div class="line">    DRWN_LOG_MESSAGE(<span class="stringliteral">&quot;hello world&quot;</span>);</div><div class="line">    DRWN_LOG_VERBOSE(<span class="stringliteral">&quot;hello world again&quot;</span>);</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="drwnTutorialHelloWorld3"></a>
Create a Makefile</h2>
<p>Create a file called <code>Makefile</code> containing the following:</p>
<div class="fragment"><div class="line">INC_DIRS = -I${DARWIN}/include -I${DARWIN}/external</div><div class="line">LIBS = -L${DARWIN}/bin -ldrwnML -ldrwnPGM -ldrwnIO -ldrwnBase -lm -lpthread</div><div class="line"></div><div class="line">main:</div><div class="line">        g++ -g -o helloworld helloworld.cpp ${INC_DIRS} ${LIBS}</div><div class="line"></div><div class="line">clean:</div><div class="line">        rm -f helloworld</div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>On Mac OS X systems you may need to add <code>-stdlib=libstdc++</code> to the end of the <code>g++</code> command. You may also need to add <code>-D__APPLE</code>. On Linux systems (e.g., Ubuntu) you may need to add <code>-D__LINUX__</code>.</dd></dl>
<h2><a class="anchor" id="drwnTutorialHelloWorld4"></a>
Make and Test the Application</h2>
<p>The following shell commands will build the <code>helloworld</code> application and run it with some different settings.</p>
<div class="fragment"><div class="line">make</div><div class="line"></div><div class="line">./helloworld</div><div class="line">./helloworld -verbose</div><div class="line">./helloworld -quiet</div><div class="line">./helloworld -<span class="keyword">set</span> <a class="code" href="classdrwnLogger.html">drwnLogger</a> logLevel ERROR</div><div class="line">./helloworld -log log.txt</div><div class="line">cat log.txt</div><div class="line"></div><div class="line">./helloworld -help</div><div class="line">./helloworld -config</div></div><!-- fragment --><h1><a class="anchor" id="drwnTutorialBase"></a>
Base and IO Libraries (drwnBase and drwnIO)</h1>
<h2><a class="anchor" id="drwnTutorialCmdline"></a>
Command Line Processing</h2>
<p><b>Darwin</b> provides a number of mechanisms for configuring applications from the command-ine. This is a very basic tutorial to get you familiar with the two main mechanisms&mdash;commandline options and XML configuration. Be sure to read the commandline processing documentation (<a class="el" href="group__drwnBase.html#drwnCommandLineDoc">Command Line Processing</a>) and the configuration module documentation (<a class="el" href="group__drwnBase.html#drwnConfigManagerDoc">Configuration Manager</a>).</p>
<p>The following code is an example of how to configure a <b>Darwin</b> application either via the commandline options or an XML configuration file.</p>
<div class="fragment"><div class="line"><span class="comment">// c++ standard headers</span></div><div class="line"><span class="preprocessor">#include &lt;cstdlib&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;cstdio&gt;</span></div><div class="line"></div><div class="line"><span class="comment">// darwin library headers</span></div><div class="line"><span class="preprocessor">#include &quot;drwnBase.h&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacestd.html">std</a>;</div><div class="line"></div><div class="line"><span class="comment">// configuration manager -----------------------------------------------------</span></div><div class="line"></div><div class="line"><span class="keyword">class </span>MyConfigureableModule : <span class="keyword">public</span> <a class="code" href="classdrwnConfigurableModule.html">drwnConfigurableModule</a> {</div><div class="line"><span class="keyword">public</span>:</div><div class="line">   <span class="keywordtype">string</span> INPUT_STRING;</div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line">   MyConfigureableModule() : <a class="code" href="classdrwnConfigurableModule.html">drwnConfigurableModule</a>(<span class="stringliteral">&quot;MyModule&quot;</span>) { }</div><div class="line">   ~MyConfigureableModule() { }</div><div class="line"></div><div class="line">   <span class="keywordtype">void</span> usage(ostream &amp;os)<span class="keyword"> const </span>{</div><div class="line">     os &lt;&lt; <span class="stringliteral">&quot;    This is an example configurable module\n&quot;</span>;</div><div class="line">     os &lt;&lt; <span class="stringliteral">&quot;      input         :: message string\n&quot;</span>;</div><div class="line">   }</div><div class="line"></div><div class="line">   <span class="keywordtype">void</span> setConfiguration(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keyword">const</span> <span class="keywordtype">char</span> *value) {</div><div class="line">     <span class="keywordflow">if</span> (!strcmp(name, <span class="stringliteral">&quot;input&quot;</span>)) {</div><div class="line">       INPUT_STRING = string(value);</div><div class="line">     } <span class="keywordflow">else</span> {</div><div class="line">       DRWN_LOG_FATAL(<span class="stringliteral">&quot;unrecognized configuration option &quot;</span> &lt;&lt; name &lt;&lt; <span class="stringliteral">&quot; for &quot;</span> &lt;&lt; this-&gt;name());</div><div class="line">     }</div><div class="line">   }</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">static</span> MyConfigureableModule gMyConfig;</div><div class="line"></div><div class="line"><span class="comment">// usage ---------------------------------------------------------------------</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> usage()</div><div class="line">{</div><div class="line">    cerr &lt;&lt; DRWN_USAGE_HEADER &lt;&lt; endl;</div><div class="line">    cerr &lt;&lt; <span class="stringliteral">&quot;USAGE: ./cmdline [OPTIONS]\n&quot;</span>;</div><div class="line">    cerr &lt;&lt; <span class="stringliteral">&quot;OPTIONS:\n&quot;</span></div><div class="line">         &lt;&lt; <span class="stringliteral">&quot;  -i &lt;message&gt;      :: input message\n&quot;</span></div><div class="line">         &lt;&lt; DRWN_STANDARD_OPTIONS_USAGE</div><div class="line">         &lt;&lt; endl;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// main ----------------------------------------------------------------------</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div><div class="line">{</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *input = NULL;</div><div class="line"></div><div class="line">    DRWN_BEGIN_CMDLINE_PROCESSING(argc, argv)</div><div class="line">        DRWN_CMDLINE_STR_OPTION(<span class="stringliteral">&quot;-i&quot;</span>, input)</div><div class="line">    DRWN_END_CMDLINE_PROCESSING(usage());</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (input != NULL)</div><div class="line">        gMyConfig.INPUT_STRING = string(input);</div><div class="line"></div><div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Input message is \&quot;&quot;</span> &lt;&lt; gMyConfig.INPUT_STRING &lt;&lt; <span class="stringliteral">&quot;\&quot;\n&quot;</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p>Note that there is no semicolon (";") after the intermediate commandline processing macros.</p>
<p>Create the following configuration file called "myConfig.xml": </p><div class="fragment"><div class="line">&lt;<a class="code" href="namespacedrwn.html">drwn</a>&gt;</div><div class="line">  &lt;MyModule input=<span class="stringliteral">&quot;hello&quot;</span> /&gt;</div><div class="line">&lt;/<a class="code" href="namespacedrwn.html">drwn</a>&gt;</div></div><!-- fragment --><p>Compile the code and then run with the following options: </p><div class="fragment"><div class="line">./cmdline -i <span class="stringliteral">&quot;hello&quot;</span></div><div class="line">./cmdline -<span class="keyword">set</span> MyModule input <span class="stringliteral">&quot;hello&quot;</span></div><div class="line">./cmdline -config myConfig.xml</div><div class="line">./cmdline -<span class="keyword">set</span> MyModule output <span class="stringliteral">&quot;hello&quot;</span></div><div class="line"></div><div class="line">./cmdline -help</div><div class="line">./cmdline -<span class="keyword">set</span> MyModule</div><div class="line"></div><div class="line">./cmdline -i <span class="stringliteral">&quot;hello&quot;</span> -i <span class="stringliteral">&quot;goodbye&quot;</span></div><div class="line">./cmdline -i <span class="stringliteral">&quot;hello&quot;</span> -<span class="keyword">set</span> MyModule input <span class="stringliteral">&quot;goodbye&quot;</span></div><div class="line">./cmdline -<span class="keyword">set</span> MyModule input <span class="stringliteral">&quot;hello&quot;</span> -i <span class="stringliteral">&quot;goodbye&quot;</span></div></div><!-- fragment --><dl class="section see"><dt>See also</dt><dd><a class="el" href="group__drwnBase.html">drwnBase</a>, <a class="el" href="group__drwnIO.html">drwnIO</a></dd></dl>
<h2><a class="anchor" id="drwnTutorialXML"></a>
XML I/O</h2>
<p>This tutorial demonstrates how to make use of <b>Darwin's</b> XML utilities for serializing objects to disk. Any class derived from <a class="el" href="classdrwnWriteable.html" title="interface for objects that can serialize and de-serialize themselves ">drwnWriteable</a> will have access to <a class="el" href="classdrwnWriteable.html#abc63779bac847ca1d4dabfb45b236066">read</a> and <a class="el" href="classdrwnWriteable.html#a8baade50e837398acc266c949de2d9a2">write</a> methods that read and write XML files to disk. The derived class will need to override the <a class="el" href="classdrwnWriteable.html#addac871b8f12f474c3ef32fb3cf28b09">load</a> and <a class="el" href="classdrwnWriteable.html#a60834c6c05b90845cbcc8a06fdea84a3">save</a> methods.</p>
<p>We will begin by creating a serializeable class that holds a person's name and age.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>Person : <span class="keyword">public</span> <a class="code" href="classdrwnWriteable.html">drwnWriteable</a> {</div><div class="line">    <span class="keyword">protected</span>:</div><div class="line">        <span class="keywordtype">string</span> _name;</div><div class="line">        <span class="keywordtype">int</span> _age;</div><div class="line"></div><div class="line">    <span class="keyword">public</span>:</div><div class="line">        Person() : _age(0) { <span class="comment">/* do nothing */</span> }</div><div class="line">        Person(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; name, <span class="keywordtype">int</span> age) : _name(name), _age(age) { <span class="comment">/* do nothing */</span> }</div><div class="line"></div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span>* type()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="stringliteral">&quot;Person&quot;</span>; }</div><div class="line"></div><div class="line">        <span class="keywordtype">bool</span> <a class="code" href="drwnXMLUtils_8h.html#a02bd9a573bfc57ca65f0c92e5656d3d4">save</a>(drwnXMLNode&amp; xml)<span class="keyword"> const </span>{</div><div class="line">            <a class="code" href="drwnXMLParser_8h.html#a80e4a523dbf2d6b49c18ca7e67563f53">drwnAddXMLAttribute</a>(xml, <span class="stringliteral">&quot;name&quot;</span>, _name.c_str(), <span class="keyword">false</span>);</div><div class="line">            <a class="code" href="drwnXMLParser_8h.html#a80e4a523dbf2d6b49c18ca7e67563f53">drwnAddXMLAttribute</a>(xml, <span class="stringliteral">&quot;age&quot;</span>, <a class="code" href="drwnStrUtils_8h.html#a73ae7e986e8c63298610d330578f5b74">toString</a>(_age).c_str(), <span class="keyword">false</span>);</div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordtype">bool</span> <a class="code" href="drwnXMLUtils_8h.html#a2fca02d61876cbdab6c38edcf34a285d">load</a>(drwnXMLNode&amp; xml) {</div><div class="line">            _name = string(<a class="code" href="drwnXMLParser_8h.html#addb5b792bc12639ad0db9e93bc10600c">drwnGetXMLAttribute</a>(xml, <span class="stringliteral">&quot;name&quot;</span>));</div><div class="line">            _age = atoi(<a class="code" href="drwnXMLParser_8h.html#addb5b792bc12639ad0db9e93bc10600c">drwnGetXMLAttribute</a>(xml, <span class="stringliteral">&quot;age&quot;</span>));</div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">        }</div><div class="line">};</div></div><!-- fragment --><p>Of course, to be useful this class would need to implement a number of other methods (for example, member variable accessors). However, this lean implementation is enough for our purposes in this tutorial.</p>
<p>We now create a class that aggregates many people into a single group.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>Group : <span class="keyword">public</span> <a class="code" href="classdrwnWriteable.html">drwnWriteable</a> {</div><div class="line">    <span class="keyword">protected</span>:</div><div class="line">        vector&lt;Person&gt; _people;</div><div class="line"></div><div class="line">    <span class="keyword">public</span>:</div><div class="line">        Group() { <span class="comment">/* do nothing */</span> }</div><div class="line"></div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span>* type()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="stringliteral">&quot;Group&quot;</span>; }</div><div class="line"></div><div class="line">        <span class="keywordtype">bool</span> <a class="code" href="drwnXMLUtils_8h.html#a02bd9a573bfc57ca65f0c92e5656d3d4">save</a>(drwnXMLNode&amp; xml)<span class="keyword"> const </span>{</div><div class="line">            <a class="code" href="drwnXMLUtils_8h.html#a575f1a993e54be86b412d77ef5142f08">drwnXMLUtils::save</a>(xml, <span class="stringliteral">&quot;Person&quot;</span>, _people);</div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordtype">bool</span> <a class="code" href="drwnXMLUtils_8h.html#a2fca02d61876cbdab6c38edcf34a285d">load</a>(drwnXMLNode&amp; xml) {</div><div class="line">            _people.clear();</div><div class="line">            <a class="code" href="drwnXMLUtils_8h.html#a2fca02d61876cbdab6c38edcf34a285d">drwnXMLUtils::load</a>(xml, <span class="stringliteral">&quot;Person&quot;</span>, _people);</div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordtype">void</span> addMember(<span class="keyword">const</span> Person&amp; person) {</div><div class="line">            _people.push_back(person);</div><div class="line">        }</div><div class="line">};</div></div><!-- fragment --><p>Finally, we create an application that populates a group of people and writes the group to disk.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">    Group group;</div><div class="line"></div><div class="line">    group.addMember(Person(<span class="stringliteral">&quot;Bart&quot;</span>, 10));</div><div class="line">    group.addMember(Person(<span class="stringliteral">&quot;Lisa&quot;</span>, 8));</div><div class="line">    group.addMember(Person(<span class="stringliteral">&quot;Maggie&quot;</span>, 1));</div><div class="line"></div><div class="line">    group.write(<span class="stringliteral">&quot;TheSimpsons.xml&quot;</span>);</div><div class="line">    group.dump();</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p>Compile this program (you will need to write the appropriate <code>makefile</code>), run it, and examine the output.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__drwnBase.html">drwnBase</a>, <a class="el" href="group__drwnIO.html">drwnIO</a> </dd>
<dd>
<a class="el" href="drwnXMLParser_8h.html#drwnXMLParser">drwnXMLParser</a>, <a class="el" href="group__drwnBase.html#drwnXMLUtilsDoc">XML Utilities</a></dd></dl>
<h2><a class="anchor" id="drwnTutorialPersistentStorage"></a>
Persistent Storage Management</h2>
<p>Often we wish to store large volumes of binary data between sessions where XML files may be too inefficient or memory intensive. The <a class="el" href="classdrwnPersistentStorage.html" title="Provides indexed storage for multiple records using two files (a binary data file and a text index fi...">drwnPersistentStorage</a> class provides a simple mechanism for storing and managing the reading and writing of multiple data records for such situations.</p>
<p>Suppose the data we wish to store is of type <code>std::vector&lt;double&gt;</code>. The first step is to provide a <a class="el" href="classdrwnPersistentRecord.html" title="Interface class for drwnPersistentStorage. ">drwnPersistentRecord</a> wrapper:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>Record : <span class="keyword">public</span> <a class="code" href="classdrwnPersistentRecord.html">drwnPersistentRecord</a> {</div><div class="line">  <span class="keyword">public</span>:</div><div class="line">    vector&lt;double&gt; data;</div><div class="line"> </div><div class="line">  <span class="keyword">public</span>:</div><div class="line">    Record(<span class="keywordtype">size_t</span> n = 0) { data.resize(n); }</div><div class="line">    ~Record() { <span class="comment">/* do nothing */</span> }</div><div class="line"></div><div class="line">    <span class="comment">// number of bytes needed to represent the data on disk include length field</span></div><div class="line">    <span class="keywordtype">size_t</span> numBytesOnDisk()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> data.size() * <span class="keyword">sizeof</span>(double) + <span class="keyword">sizeof</span>(<span class="keywordtype">size_t</span>); }</div><div class="line"></div><div class="line">    <span class="comment">// write the data to disk</span></div><div class="line">    <span class="keywordtype">bool</span> <a class="code" href="drwnXMLUtils_8h.html#a6a883b13b61c8b6c5062a91b04e6dec7">write</a>(ostream&amp; os)<span class="keyword"> const </span>{</div><div class="line">      <span class="keywordtype">size_t</span> rows = data.size();</div><div class="line">      os.write((<span class="keywordtype">char</span> *)&amp;rows, <span class="keyword">sizeof</span>(<span class="keywordtype">size_t</span>));</div><div class="line">      <span class="keywordflow">if</span> (rows &gt; 0) {</div><div class="line">        os.write((<span class="keywordtype">char</span> *)&amp;data[0], rows * <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div><div class="line">      }</div><div class="line">      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// read the data from disk</span></div><div class="line">    <span class="keywordtype">bool</span> <a class="code" href="drwnXMLUtils_8h.html#a71a15735037a63768a9d60ddf4a6ae5f">read</a>(istream&amp; is) {</div><div class="line">      <span class="keywordtype">size_t</span> rows = 0;</div><div class="line">      is.read((<span class="keywordtype">char</span> *)&amp;rows, <span class="keyword">sizeof</span>(<span class="keywordtype">size_t</span>));</div><div class="line">      data.resize(rows);</div><div class="line">      <span class="keywordflow">if</span> (rows &gt; 0) {</div><div class="line">         is.read((<span class="keywordtype">char</span> *)&amp;data[0], rows * <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div><div class="line">      }</div><div class="line">      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">    }</div><div class="line">};</div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>The <b>Darwin</b> library provides the templated convenience class <a class="el" href="classdrwnPersistentVectorRecord.html" title="Templated class for storing vector records. ">drwnPersistentVectorRecord</a> for storing vectors of objects. The class is implemented similar to the above.</dd></dl>
<p>We can now easily read, write and modify data records.</p>
<div class="fragment"><div class="line"><span class="comment">// open a persistent storage object</span></div><div class="line"><a class="code" href="classdrwnPersistentStorage.html">drwnPersistentStorage</a> storage;</div><div class="line">storage.<a class="code" href="classdrwnPersistentStorage.html#a0a4b9cabb8f996afdfa563367e7b1798">open</a>(<span class="stringliteral">&quot;/tmp/data&quot;</span>);</div><div class="line"></div><div class="line"><span class="comment">// write some records</span></div><div class="line">Record rec(1000);</div><div class="line">storage.<a class="code" href="classdrwnPersistentStorage.html#a015314f4ef392424ea90597ac570664d">write</a>(<span class="stringliteral">&quot;record A&quot;</span>, &amp;rec);</div><div class="line">rec = Record(2000);</div><div class="line">storage.<a class="code" href="classdrwnPersistentStorage.html#a015314f4ef392424ea90597ac570664d">write</a>(<span class="stringliteral">&quot;record B&quot;</span>, &amp;rec);</div><div class="line"></div><div class="line"><span class="comment">// read back record A</span></div><div class="line">storage.<a class="code" href="classdrwnPersistentStorage.html#ad785a73aec6aceab2ce6092fcebb9852">read</a>(<span class="stringliteral">&quot;record A&quot;</span>, &amp;rec);</div><div class="line"></div><div class="line"><span class="comment">// print number of bytes used</span></div><div class="line">cout &lt;&lt; storage.<a class="code" href="classdrwnPersistentStorage.html#a1cc32fb1496a9e74590a6d303798a5f1">numTotalBytes</a>() &lt;&lt; <span class="stringliteral">&quot; bytes stored\n&quot;</span>;</div></div><!-- fragment --><p>The data is stored permenantly when the application closes and can be read later by re-opening the same storage file.</p>
<dl class="section warning"><dt>Warning</dt><dd>Abnormal termination of an application may result in corrupt data storage.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>The <a class="el" href="classdrwnPersistentRecord.html" title="Interface class for drwnPersistentStorage. ">drwnPersistentRecord</a> interface can co-exists with the <a class="el" href="classdrwnWriteable.html" title="interface for objects that can serialize and de-serialize themselves ">drwnWriteable</a> interface allowing objects to be written either to XML files or to a persistent <b>Darwin</b> storage file.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__drwnBase.html">drwnBase</a>, <a class="el" href="group__drwnIO.html">drwnIO</a></dd></dl>
<h1><a class="anchor" id="drwnTutorialML"></a>
Machine Learning Library (drwnML)</h1>
<p>The <a class="el" href="group__drwnML.html">drwnML</a> library implements a number of basic machine learning and pattern recognition algorithms. These are explored in the following tutorials.</p>
<h2><a class="anchor" id="drwnTutorialGaussians"></a>
Gaussian Distributions</h2>
<p><b>Darwin</b> provides functionality for estimating the parameters of, sampling from, computing sample likelihoods, and conditioning on multi-dimensional Gaussian and mixture of Gaussian probability distributions. The following example shows how to define a two-dimensional Gaussian and then condition on the first variable to produce some one-dimensional Gaussian distributions.</p>
<div class="fragment"><div class="line"><span class="comment">// define mean and covariance</span></div><div class="line">VectorXd mu(2);</div><div class="line">mu &lt;&lt; 0.5, 0.5;</div><div class="line"></div><div class="line">MatrixXd sigma(2, 2);</div><div class="line">sigma &lt;&lt; 0.0964, -0.0505, -0.0505, 0.0540;</div><div class="line"></div><div class="line"><span class="comment">// create gaussian P(x_1, x_2)</span></div><div class="line"><a class="code" href="classdrwnGaussian.html">drwnGaussian</a> g(mu, sigma);</div><div class="line"></div><div class="line"><span class="comment">// create conditional gaussian P(x_2 | x_1 = 1.0)</span></div><div class="line">map&lt;int, double&gt; x;</div><div class="line">x[0] = 1.0;</div><div class="line"><a class="code" href="classdrwnGaussian.html">drwnGaussian</a> g2 = g.<a class="code" href="classdrwnGaussian.html#ac28b663f6a19ba8dab8f35a956cf54d5">reduce</a>(x);</div><div class="line"></div><div class="line"><span class="comment">// show mean vector</span></div><div class="line">DRWN_LOG_MESSAGE(<span class="stringliteral">&quot;mean = &quot;</span> &lt;&lt; g2.<a class="code" href="classdrwnGaussian.html#a226429a827dd8746c9695861b4e91031">mean</a>().transpose());</div></div><!-- fragment --><p>When performing multiple repeated conditioning on large Gaussians, creating an intermediate <a class="el" href="classdrwnConditionalGaussian.html" title="Utility class for generating conditonal gaussian distribution. ">drwnConditionalGaussian</a> object is more efficient since it will cache some intermediate calculations.</p>
<p><b>Exercise</b>. Extend the above example to produce samples from the conditional distribution.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__drwnBase.html">drwnBase</a>, <a class="el" href="group__drwnIO.html">drwnIO</a>, <a class="el" href="group__drwnML.html">drwnML</a></dd></dl>
<h2><a class="anchor" id="drwnTutorialFeatureTransforms"></a>
Feature Transforms</h2>
<p>The <a class="el" href="classdrwnFeatureTransform.html" title="Implements the interface for a generic feature transforms possibly with learned parameters, e.g., PCA (unsupervised) or LDA (supervised). ">drwnFeatureTransform</a> class defines the interface for supervised and unsupervised feature vector transformations, e.g., Fisher's LDA (supervised) or PCA (unsupervised). For many machine learning algorithms pre-processing features to have zero mean and unit variance will result in better numerical stability of the algorithm. This tutorial shows such an example.</p>
<div class="fragment"><div class="line"><span class="comment">// construct features vectors</span></div><div class="line">vector&lt;vector&lt;double&gt; &gt; x(100);</div><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; x.size(); i++) {</div><div class="line">    x[i].resize(10);</div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j = 0; j &lt; x[i].size(); j++) {</div><div class="line">        x[i][j] = (double)j + drand48();</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// learn normalization scale and offset</span></div><div class="line"><a class="code" href="classdrwnFeatureWhitener.html">drwnFeatureWhitener</a> whitener;</div><div class="line">whitener.<a class="code" href="classdrwnFeatureWhitener.html#a5194899127fadf09224615fdc4814540">train</a>(x);</div><div class="line"></div><div class="line"><span class="comment">// normalize all feature vectors in-place</span></div><div class="line">whitener.<a class="code" href="classdrwnFeatureWhitener.html#a11c83af91da2879ad75a02dc04ce24c1">transform</a>(x);</div></div><!-- fragment --><p>Once the feature transformation has been learned it can be applied to arbitrary feature vectors (i.e., not just those that where used during learning). For example,</p>
<div class="fragment"><div class="line"><span class="comment">// construct new feature vector</span></div><div class="line">vector&lt;double&gt; y(10, 0);</div><div class="line"></div><div class="line"><span class="comment">// apply previously learned transform</span></div><div class="line">whitener.<a class="code" href="classdrwnFeatureWhitener.html#a11c83af91da2879ad75a02dc04ce24c1">transform</a>(y);</div></div><!-- fragment --><p>The same data can be trasnformed via Principal Component Analysis (PCA). In the following example we set the number of output dimensions to 5.</p>
<div class="fragment"><div class="line"><span class="comment">// estimate principal directions</span></div><div class="line"><a class="code" href="classdrwnPCA.html">drwnPCA</a> pca;</div><div class="line">pca.setProperty(<span class="stringliteral">&quot;outputDim&quot;</span>, 5);</div><div class="line">pca.<a class="code" href="classdrwnPCA.html#a83c0a5f3097b77e1808c29c7edcd8fdb">train</a>(x);</div><div class="line"></div><div class="line"><span class="comment">// transform data from x to y</span></div><div class="line">vector&lt;vector&lt;double&gt; &gt; y;</div><div class="line">pca.<a class="code" href="classdrwnPCA.html#ab14857a205b24a2f93d0993a14055fd0">transform</a>(x, y);</div></div><!-- fragment --><p>We can also perform PCA on a transformed feature space, e.g.,</p>
<div class="fragment"><div class="line"><span class="comment">// estimate principal directions on modified feature space</span></div><div class="line"><a class="code" href="classdrwnPCA.html">drwnPCA</a> pca;</div><div class="line">pca.setProperty(<span class="stringliteral">&quot;outputDim&quot;</span>, 5);</div><div class="line">pca.<a class="code" href="classdrwnPCA.html#a83c0a5f3097b77e1808c29c7edcd8fdb">train</a>(x, <a class="code" href="classdrwnTFeatureMapTransform.html">drwnTFeatureMapTransform&lt;drwnSquareFeatureMap&gt;</a>());</div><div class="line"></div><div class="line"><span class="comment">// transform data via pca on modified feature space</span></div><div class="line">pca.<a class="code" href="classdrwnPCA.html#ab14857a205b24a2f93d0993a14055fd0">transform</a>(x, y, <a class="code" href="classdrwnTFeatureMapTransform.html">drwnTFeatureMapTransform&lt;drwnSquareFeatureMap&gt;</a>());</div></div><!-- fragment --><p>Here the feature vectors are automatically transformed via the <a class="el" href="classdrwnSquareFeatureMap.html" title="Augments input feature vector with square of each feature (normalized so that if input is zero mean a...">drwnSquareFeatureMap</a> before learning or applying PCA.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__drwnBase.html">drwnBase</a>, <a class="el" href="group__drwnIO.html">drwnIO</a>, <a class="el" href="group__drwnML.html">drwnML</a></dd></dl>
<h2><a class="anchor" id="drwnTutorialClassifiers"></a>
Classification and Regression</h2>
<p>Classification and regression and the two most fundamental tasks in supervised machine learning. Both tasks take as input a feature vector and produce as output a prediction. In the case of classification the prediction is a label from a small discrete set, whereas in the case of regression the prediction is a real-valued number.</p>
<h3><a class="anchor" id="drwnTutorialClassifiers1"></a>
Linear Regression</h3>
<p>The following example shows how to use the <a class="el" href="classdrwnTLinearRegressor.html" title="Implements linear regression optimization templated on a drwnFeatureMap. ">drwnTLinearRegressor</a> class for extrapolating a straight-line through some data points.</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> x[] = {1.0, 2.0, 3.0};</div><div class="line"><span class="keywordtype">double</span> y[] = {0.5, 1.7, 2.3};</div><div class="line"></div><div class="line"><span class="comment">// construct dataset</span></div><div class="line"><a class="code" href="classdrwnDataset.html">drwnRegressionDataset</a> dataset;</div><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++) {</div><div class="line">  dataset.<a class="code" href="classdrwnDataset.html#a89a3a485e7a30ebb8d837a5c6d6e8d7d">append</a>(vector&lt;double&gt;(1, x[i]), y[i]);</div><div class="line">} </div><div class="line"></div><div class="line"><span class="comment">// learn linear regression model</span></div><div class="line"><a class="code" href="classdrwnTLinearRegressor.html">drwnTLinearRegressor&lt;drwnBiasFeatureMap&gt;</a> model(1);</div><div class="line">model.train(dataset);</div><div class="line"></div><div class="line"><span class="comment">// show points from 0 to 5</span></div><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">double</span> i = 0.0; i &lt;= 5.0; i += 1.0) {</div><div class="line">  DRWN_LOG_MESSAGE(<span class="stringliteral">&quot;value at x=&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; is &quot;</span></div><div class="line">    &lt;&lt; model.getRegression(vector&lt;double&gt;(1, i)));</div><div class="line">}</div></div><!-- fragment --><h3><a class="anchor" id="drwnTutorialClassifiers2"></a>
Classification</h3>
<p>The following code shows a how to use the <a class="el" href="classdrwnClassifier.html" title="Implements the interface for a generic machine learning classifier. ">drwnClassifier</a> class.</p>
<div class="fragment"><div class="line"><span class="comment">// parameters</span></div><div class="line"><span class="keyword">const</span> <span class="keywordtype">double</span> SIGNAL2NOISE = 1.5;</div><div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> NUMPOSSAMPLES = 10;</div><div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> NUMNEGSAMPLES = 20;</div><div class="line"></div><div class="line"><span class="comment">// construct dataset</span></div><div class="line"><a class="code" href="classdrwnDataset.html">drwnClassifierDataset</a> dataset;</div><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; NUMPOSSAMPLES; i++) {</div><div class="line">  dataset.<a class="code" href="classdrwnDataset.html#a89a3a485e7a30ebb8d837a5c6d6e8d7d">append</a>(vector&lt;double&gt;(1, SIGNAL2NOISE * 2.0 * (drand48() - 1.0)), 1);</div><div class="line">}</div><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; NUMNEGSAMPLES; i++) {</div><div class="line">  dataset.<a class="code" href="classdrwnDataset.html#a89a3a485e7a30ebb8d837a5c6d6e8d7d">append</a>(vector&lt;double&gt;(1, SIGNAL2NOISE * 2.0 * (drand48() - 1.0) + 1.0), 0);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// learn and evaluate different classifiers</span></div><div class="line"><a class="code" href="classdrwnClassifier.html">drwnClassifier</a> *model;</div><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++) {</div><div class="line">  <span class="comment">// instantiate the classifier</span></div><div class="line">  <span class="keywordflow">if</span> (i == 0) {</div><div class="line">    DRWN_LOG_MESSAGE(<span class="stringliteral">&quot;logistic classifier&quot;</span>);</div><div class="line">    model = <span class="keyword">new</span> <a class="code" href="classdrwnTMultiClassLogistic.html">drwnTMultiClassLogistic&lt;drwnBiasJointFeatureMap&gt;</a>(1, 2);</div><div class="line">  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i == 1) {</div><div class="line">    DRWN_LOG_MESSAGE(<span class="stringliteral">&quot;boosted classifier&quot;</span>);</div><div class="line">    model = <span class="keyword">new</span> <a class="code" href="classdrwnBoostedClassifier.html">drwnBoostedClassifier</a>(1, 2);</div><div class="line">  } <span class="keywordflow">else</span> {</div><div class="line">    DRWN_LOG_MESSAGE(<span class="stringliteral">&quot;decision-tree classifier&quot;</span>);</div><div class="line">    model = <span class="keyword">new</span> <a class="code" href="classdrwnDecisionTree.html">drwnDecisionTree</a>(1, 2);</div><div class="line">  }</div><div class="line">  </div><div class="line">  <span class="comment">// learn the paremeters</span></div><div class="line">  model-&gt;<a class="code" href="classdrwnClassifier.html#a648e65d9e449aa4970699e304eb8c871">train</a>(dataset);</div><div class="line"></div><div class="line">  <span class="comment">// show confusion matrix (on the training set)</span></div><div class="line">  <a class="code" href="classdrwnConfusionMatrix.html">drwnConfusionMatrix</a> confusion(2, 2);</div><div class="line">  confusion.accumulate(dataset, model);</div><div class="line">  confusion.printCounts();</div><div class="line"></div><div class="line">  <span class="keyword">delete</span> model;</div><div class="line">}</div></div><!-- fragment --><p>The feature mapping used by the multi-class logistic classifier can be easily changed. For example, to augment the square of each feature use</p>
<div class="fragment"><div class="line">model = <span class="keyword">new</span> <a class="code" href="classdrwnTMultiClassLogistic.html">drwnTMultiClassLogistic&lt;drwnSquareJointFeatureMap&gt;</a>(1, 2);</div></div><!-- fragment --><p>The code snippet above shows analysis of the results on the training set by printing a confusion matrix. Analysis should really be done on a separate hold-out set. In addition to the confusion matrix you may be interested in plotting a precision-recall curve (see <a class="el" href="classdrwnClassificationResults.html" title="Encapsulates summary of classifier output from which various curves can be generated (e...">drwnClassificationResults</a>).</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__drwnBase.html">drwnBase</a>, <a class="el" href="group__drwnIO.html">drwnIO</a>, <a class="el" href="group__drwnML.html">drwnML</a></dd></dl>
<h1><a class="anchor" id="drwnTutorialPGM"></a>
Probablistic Graphical Models Library (drwnPGM)</h1>
<p>The <a class="el" href="group__drwnPGM.html">drwnPGM</a> library provides infrastructure for representing and manipulating graphical models such as Bayesian Networks and Markov random fields. This section gives you an overview of some of the functionality of the library. We begin by demonstrating construction of a factor over a set of discrete variables and then move onto a simple energy minimization example followed by a Viterbi decoding example. The tutorial ends with some advanced topics, specifically, creating factor operations and sharing factor storage.</p>
<h2><a class="anchor" id="drwnTutorialFactor"></a>
Factor Construction</h2>
<p>A factor is a table containing a value for each assignment to a set of random variables. The following code shows how to construct a factor <b>psi</b> over two variables <b>A</b> and <b>B</b>.</p>
<div class="fragment"><div class="line"><span class="comment">// define variables</span></div><div class="line"><a class="code" href="classdrwnSmartPointer.html">drwnVarUniversePtr</a> universe(<span class="keyword">new</span> <a class="code" href="classdrwnVarUniverse.html">drwnVarUniverse</a>());</div><div class="line">universe-&gt;addVariable(3, <span class="stringliteral">&quot;A&quot;</span>); <span class="comment">// variable A has cardinality 3</span></div><div class="line">universe-&gt;addVariable(2, <span class="stringliteral">&quot;B&quot;</span>); <span class="comment">// variable B has cardinality 2</span></div><div class="line"></div><div class="line"><span class="comment">// construct factor (populated with random entries)</span></div><div class="line"><a class="code" href="classdrwnTableFactor.html">drwnTableFactor</a> psi(universe);</div><div class="line">psi.addVariable(0);</div><div class="line">psi.addVariable(1);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> indx = 0;</div><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> b = 0; b &lt; universe-&gt;varCardinality(1); b++) {</div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> a = 0; a &lt; universe-&gt;varCardinality(0); a++) {</div><div class="line">        psi[indx++] = drand48();</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>You can also set values for a factor using the <a class="el" href="classdrwnFactor.html#a40739ae2c855898d32a10aefd9620e78" title="Sets the value of the factor for a given (full) assignment. ">drwnFactor::setValueOf</a> function.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__drwnBase.html">drwnBase</a>, <a class="el" href="group__drwnIO.html">drwnIO</a>, <a class="el" href="group__drwnPGM.html">drwnPGM</a></dd></dl>
<h2><a class="anchor" id="drwnTutorialFactorOps"></a>
Basic Factor Operations</h2>
<p>When developing algorithms we often wish to perform a core set of operations on the factors in the graphical model. These operations are encapsulated by the <a class="el" href="classdrwnFactorOperation.html" title="Base class for implementing various operations on table factors. The derived classes store mappings b...">drwnFactorOperation</a> class and classes derived from it. The following code snippets show some simple operation use-cases. More complex examples are demonstrated in subsequent sections of this tutorial.</p>
<div class="fragment"><div class="line"><span class="comment">// use the example code in the previous section to generate</span></div><div class="line"><span class="comment">// a joint probability distribution P = 1/Z exp(-E)</span></div><div class="line"><a class="code" href="classdrwnTableFactor.html">drwnTableFactor</a> prJoint(psi);</div><div class="line">prJoint.scale(-1.0);</div><div class="line"><a class="code" href="classdrwnFactorExpAndNormalizeOp.html">drwnFactorExpAndNormalizeOp</a>(&amp;prJoint).<a class="code" href="classdrwnFactorExpAndNormalizeOp.html#ad72a635e495dfc4bfc6525b876906547">execute</a>();</div><div class="line"></div><div class="line"><span class="comment">// compute the marginal over variable &quot;A&quot; by marginalizing out variable &quot;B&quot;</span></div><div class="line"><a class="code" href="classdrwnTableFactor.html">drwnTableFactor</a> prA(universe);</div><div class="line"><a class="code" href="classdrwnFactorMarginalizeOp.html">drwnFactorMarginalizeOp</a>(&amp;prA, &amp;prJoint, universe-&gt;findVariable(<span class="stringliteral">&quot;B&quot;</span>)).execute();</div><div class="line"></div><div class="line"><span class="comment">// compute the conditional distribution of variable &quot;A&quot; given variable &quot;B&quot;</span></div><div class="line"><span class="comment">// is assigned value 0</span></div><div class="line"><a class="code" href="classdrwnTableFactor.html">drwnTableFactor</a> prAGivenB0(universe);</div><div class="line"><a class="code" href="classdrwnFactorReduceOp.html">drwnFactorReduceOp</a>(&amp;prAGivenB0, &amp;prJoint, universe-&gt;findVariable(<span class="stringliteral">&quot;B&quot;</span>), 0).execute();</div><div class="line"><a class="code" href="classdrwnFactorNormalizeOp.html">drwnFactorNormalizeOp</a>(&amp;prAGivenB0).<a class="code" href="classdrwnFactorNormalizeOp.html#a3ef0181ad8c3780301e8d50803704cdd">execute</a>();</div></div><!-- fragment --><dl class="section see"><dt>See also</dt><dd><a class="el" href="group__drwnBase.html">drwnBase</a>, <a class="el" href="group__drwnIO.html">drwnIO</a>, <a class="el" href="group__drwnPGM.html">drwnPGM</a></dd></dl>
<h2><a class="anchor" id="drwnTutorialEnergyMin"></a>
Energy Minimization</h2>
<p>Consider the following energy minimization problem over discrete random variables <b>x</b>, </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \textrm{minimize} \; \sum_{c} \psi_c(\mathbf{x}_c) \]" src="form_9.png"/>
</p>
<p>A large number of algorithms have been proposed for (approximately or exactly) solving this problem depending on the structure and properties of the energy function. <b>Darwin</b> implements a number of these algorithms and in this tutorial we demonstrate using the ICM algorithm (Besag, 1975).</p>
<p>We first construct a factor graph representation of the energy function.</p>
<div class="fragment"><div class="line"><span class="comment">// variable universe: 5 variables each of cardinality 3</span></div><div class="line"><a class="code" href="classdrwnSmartPointer.html">drwnVarUniversePtr</a> universe(<span class="keyword">new</span> <a class="code" href="classdrwnVarUniverse.html">drwnVarUniverse</a>(5, 3));</div><div class="line"></div><div class="line"><span class="comment">// create two factors (populated with random entries)</span></div><div class="line"><a class="code" href="classdrwnTableFactor.html">drwnTableFactor</a> *ABC = <span class="keyword">new</span> <a class="code" href="classdrwnTableFactor.html">drwnTableFactor</a>(universe);</div><div class="line">ABC-&gt;<a class="code" href="classdrwnTableFactor.html#aabf14071ae5c0cb5031918b82f17e650">addVariable</a>(0); ABC-&gt;<a class="code" href="classdrwnTableFactor.html#aabf14071ae5c0cb5031918b82f17e650">addVariable</a>(1); ABC-&gt;<a class="code" href="classdrwnTableFactor.html#aabf14071ae5c0cb5031918b82f17e650">addVariable</a>(2);</div><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> xc = 0; xc &lt; ABC-&gt;entries(); xc++) {</div><div class="line">    (*ABC)[xc] = drand48();</div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="classdrwnTableFactor.html">drwnTableFactor</a> *CDE = <span class="keyword">new</span> <a class="code" href="classdrwnTableFactor.html">drwnTableFactor</a>(universe);</div><div class="line">CDE-&gt;<a class="code" href="classdrwnTableFactor.html#aabf14071ae5c0cb5031918b82f17e650">addVariable</a>(2); CDE-&gt;<a class="code" href="classdrwnTableFactor.html#aabf14071ae5c0cb5031918b82f17e650">addVariable</a>(3); CDE-&gt;<a class="code" href="classdrwnTableFactor.html#aabf14071ae5c0cb5031918b82f17e650">addVariable</a>(4);</div><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> xc = 0; xc &lt; CDE-&gt;entries(); xc++) {</div><div class="line">    (*CDE)[xc] = drand48();</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// add to factor graph</span></div><div class="line"><span class="comment">// (the graph takes ownership so no need to free factors)</span></div><div class="line"><a class="code" href="classdrwnFactorGraph.html">drwnFactorGraph</a> graph;</div><div class="line">graph.<a class="code" href="classdrwnFactorGraph.html#a9e0c66a976835c4d6267634b594e0976">addFactor</a>(ABC);</div><div class="line">graph.<a class="code" href="classdrwnFactorGraph.html#a9e0c66a976835c4d6267634b594e0976">addFactor</a>(CDE);</div></div><!-- fragment --><p>Now let's try use ICM to compute the minimum-energy assignment:</p>
<div class="fragment"><div class="line"><a class="code" href="classdrwnICMInference.html">drwnICMInference</a> icm(graph);</div><div class="line"><a class="code" href="drwnVarAssignment_8h.html#a3e1bee985437ac5ac5565f4c713f57a9">drwnFullAssignment</a> assignment;</div><div class="line">icm.inference(assignment);</div><div class="line">DRWN_LOG_MESSAGE(<span class="stringliteral">&quot;assignment has energy &quot;</span> &lt;&lt; graph.<a class="code" href="classdrwnFactorGraph.html#ac4a4f1b5861327fd723a4996ef3da7d4">getEnergy</a>(assignment));</div><div class="line">DRWN_LOG_VERBOSE(<span class="stringliteral">&quot;assignment is &quot;</span> &lt;&lt; <a class="code" href="drwnStrUtils_8h.html#a73ae7e986e8c63298610d330578f5b74">toString</a>(assignment));</div></div><!-- fragment --><p>For low treewidth graphs we can use the junction tree algorithm, which first triangulates the graph, to compute the exact MAP assignment:</p>
<div class="fragment"><div class="line"><a class="code" href="classdrwnJunctionTreeInference.html">drwnJunctionTreeInference</a> jta(graph);</div><div class="line"><a class="code" href="drwnVarAssignment_8h.html#a3e1bee985437ac5ac5565f4c713f57a9">drwnFullAssignment</a> assignment;</div><div class="line">jta.inference(assignment);</div><div class="line">DRWN_LOG_MESSAGE(<span class="stringliteral">&quot;assignment has energy &quot;</span> &lt;&lt; graph.<a class="code" href="classdrwnFactorGraph.html#ac4a4f1b5861327fd723a4996ef3da7d4">getEnergy</a>(assignment));</div><div class="line">DRWN_LOG_VERBOSE(<span class="stringliteral">&quot;map assignment is &quot;</span> &lt;&lt; <a class="code" href="drwnStrUtils_8h.html#a73ae7e986e8c63298610d330578f5b74">toString</a>(assignment));</div></div><!-- fragment --><dl class="section see"><dt>See also</dt><dd><a class="el" href="group__drwnPGM.html#drwnMapInferenceDoc">MAP Inference (Energy Minimization)</a></dd></dl>
<h2><a class="anchor" id="drwnTutorialViterbi"></a>
Example: Viterbi Decoding</h2>
<p>We now provide an example of implementing the Viterbi algorithm using the factors and factor operations available in the library. The Viterbi algorithm is a method for finding the most likely sequence of states in a Markov model. For this tutorial we will assume that our model is a chain defined over <em>T</em> time steps by </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ P(\mathbf{x}) \propto \prod_{t = 1}^{T - 1} \Psi_{t}(x_t, x_{t+1}) \]" src="form_10.png"/>
</p>
<p>The following code implements the viterbi algorithm on a sequence of factors. Note that this implementation is far from optimal and intended for illustrative purposes only. Practical implementations of the algorithm would store the argmax during the forward pass to avoid the reduction computation in the backward pass. The normalization of the messages is required to avoid overflow. Some viterbi implementations avoid this by performing the computation in log-space. Try this as an exercise.</p>
<div class="fragment"><div class="line"><a class="code" href="drwnVarAssignment_8h.html#a3e1bee985437ac5ac5565f4c713f57a9">drwnFullAssignment</a> viterbi(vector&lt;drwnTableFactor&gt;&amp; factors)</div><div class="line">{</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> T = (int)factors.size() + 1;</div><div class="line">    <a class="code" href="classdrwnSmartPointer.html">drwnVarUniversePtr</a> universe(factors[0].getUniverse());</div><div class="line"></div><div class="line">    <span class="comment">// check input assumptions</span></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> t = 0; t &lt; T - 1; t++) {</div><div class="line">        DRWN_ASSERT(factors[t].size() == 2);      <span class="comment">// factor is pairwise</span></div><div class="line">        DRWN_ASSERT(factors[t].hasVariable(t));   <span class="comment">// factor has variable x_t</span></div><div class="line">        DRWN_ASSERT(factors[t].hasVariable(t+1)); <span class="comment">// factor has variable x_{t+1}</span></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// forward pass (modifies factors)</span></div><div class="line">    vector&lt;drwnTableFactor&gt; messages(T - 1, <a class="code" href="classdrwnTableFactor.html">drwnTableFactor</a>(universe));</div><div class="line"></div><div class="line">    <a class="code" href="classdrwnFactorMaximizeOp.html">drwnFactorMaximizeOp</a>(&amp;messages[0], &amp;factors[0], 0).<a class="code" href="classdrwnFactorMaximizeOp.html#a3b701edf7f520b6a5b0167385435a084">execute</a>();</div><div class="line">    <a class="code" href="classdrwnFactorNormalizeOp.html">drwnFactorNormalizeOp</a>(&amp;messages[0]).<a class="code" href="classdrwnFactorNormalizeOp.html#a3ef0181ad8c3780301e8d50803704cdd">execute</a>();</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> t = 1; t &lt; T - 1; t++) {</div><div class="line">        <a class="code" href="classdrwnFactorTimesEqualsOp.html">drwnFactorTimesEqualsOp</a>(&amp;factors[t], &amp;messages[t - 1]).<a class="code" href="classdrwnFactorTimesEqualsOp.html#a08774666a91893c3208a6955e9be8c87">execute</a>();</div><div class="line">        <a class="code" href="classdrwnFactorMaximizeOp.html">drwnFactorMaximizeOp</a>(&amp;messages[t], &amp;factors[t], t).<a class="code" href="classdrwnFactorMaximizeOp.html#a3b701edf7f520b6a5b0167385435a084">execute</a>();</div><div class="line">        <a class="code" href="classdrwnFactorNormalizeOp.html">drwnFactorNormalizeOp</a>(&amp;messages[t]).<a class="code" href="classdrwnFactorNormalizeOp.html#a3ef0181ad8c3780301e8d50803704cdd">execute</a>();</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// backward pass</span></div><div class="line">    <a class="code" href="drwnVarAssignment_8h.html#a3e1bee985437ac5ac5565f4c713f57a9">drwnFullAssignment</a> mapAssignment(T);</div><div class="line">    mapAssignment[T - 1] = messages[T - 2].indexOfMax();</div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> t = T - 2; t &gt;= 0; t--) {</div><div class="line">        <a class="code" href="classdrwnTableFactor.html">drwnTableFactor</a> mu(universe);</div><div class="line">        <a class="code" href="classdrwnFactorReduceOp.html">drwnFactorReduceOp</a>(&amp;mu, &amp;factors[t], t + 1, mapAssignment[t + 1]).<a class="code" href="classdrwnFactorReduceOp.html#a85cea12cabb75bca5e1a795a886ea602">execute</a>();</div><div class="line">        mapAssignment[t] = mu.indexOfMax();</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> mapAssignment;</div><div class="line">}</div></div><!-- fragment --><p>The following <code>main</code> function provides an example of setting up a Markov chain and calling the viterbi code.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">    <span class="comment">// define universe</span></div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> T = 5; <span class="comment">// number of time steps</span></div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> N = 3; <span class="comment">// number of states per variable</span></div><div class="line">    <a class="code" href="classdrwnSmartPointer.html">drwnVarUniversePtr</a> universe(<span class="keyword">new</span> <a class="code" href="classdrwnVarUniverse.html">drwnVarUniverse</a>(T, N));</div><div class="line"></div><div class="line">    <span class="comment">// create markov chain</span></div><div class="line">    vector&lt;drwnTableFactor&gt; factors(T - 1, <a class="code" href="classdrwnTableFactor.html">drwnTableFactor</a>(universe));</div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> t = 0; t &lt; T - 1; t++) {</div><div class="line">        factors[t].addVariable(t);</div><div class="line">        factors[t].addVariable(t + 1);</div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; N * N; i++) {</div><div class="line">            factors[t][i] = drand48();</div><div class="line">        }</div><div class="line">        factors[t].normalize();</div><div class="line">        factors[t].dump();</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// run viterbi</span></div><div class="line">    <a class="code" href="drwnVarAssignment_8h.html#a3e1bee985437ac5ac5565f4c713f57a9">drwnFullAssignment</a> assignment = viterbi(factors);</div><div class="line">    DRWN_LOG_MESSAGE(<span class="stringliteral">&quot;x^\\star = &quot;</span> &lt;&lt; <a class="code" href="drwnStrUtils_8h.html#a73ae7e986e8c63298610d330578f5b74">toString</a>(assignment));</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><dl class="section see"><dt>See also</dt><dd><a class="el" href="group__drwnBase.html">drwnBase</a>, <a class="el" href="group__drwnIO.html">drwnIO</a>, <a class="el" href="group__drwnPGM.html">drwnPGM</a></dd></dl>
<h2><a class="anchor" id="drwnTutorialUserFactorOp"></a>
Writing New Factor Operations</h2>
<p>In this tutorial we demonstrate how to write a new factor operation that computes the dot-product between two factors, i.e., given <img class="formulaInl" alt="$\psi_A(\mathbf{v}_A)$" src="form_11.png"/> and <img class="formulaInl" alt="$\psi_B(\mathbf{v}_B)$" src="form_12.png"/> with <img class="formulaInl" alt="$\mathbf{v}_A \in {\cal V}_A$" src="form_13.png"/> and <img class="formulaInl" alt="$\mathbf{v}_B \in {\cal V}_B$" src="form_14.png"/> will compute </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \sum_{\mathbf{v} \in {\cal V}_A \cup {\cal V}_{B}} \psi_A([\mathbf{v}]_A) \psi_B([\mathbf{v}]_B) \]" src="form_15.png"/>
</p>
<p>We first define the operation class. Most factor operations produce another factors and so should be derived from the drwnTableFactorOp base class. However, our factor computes a real number which we will return through a results pointer. The class is defined below. It contains a pointer to each of the input factors and the mapping between corresponding entries in those factors.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>DotProductOp {</div><div class="line"><span class="keyword">protected</span>:</div><div class="line">    <span class="keywordtype">double</span> *_result;</div><div class="line">    <span class="keyword">const</span> <a class="code" href="classdrwnTableFactor.html">drwnTableFactor</a> * <span class="keyword">const</span> _A;</div><div class="line">    <span class="keyword">const</span> <a class="code" href="classdrwnTableFactor.html">drwnTableFactor</a> * <span class="keyword">const</span> _B;</div><div class="line">    <a class="code" href="classdrwnTableFactorMapping.html">drwnTableFactorMapping</a> _mappingA;</div><div class="line">    <a class="code" href="classdrwnTableFactorMapping.html">drwnTableFactorMapping</a> _mappingB;</div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    DotProductOp(<span class="keywordtype">double</span> *result, <span class="keyword">const</span> <a class="code" href="classdrwnTableFactor.html">drwnTableFactor</a> *A, <span class="keyword">const</span> <a class="code" href="classdrwnTableFactor.html">drwnTableFactor</a> *B);</div><div class="line">    ~DotProductOp() { <span class="comment">/* do nothing */</span> };</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> execute();</div><div class="line">};</div></div><!-- fragment --><p>The constructor computes the union of the variables in each factor and the mapping between factors and this variable superset. Since the mappings are initialized on construction repeated execution of the operation (say, in an iterative algorithm where the contents of the factors are changing) are relatively cheap.</p>
<div class="fragment"><div class="line">DotProductOp::DotProductOp(<span class="keywordtype">double</span> *result, <span class="keyword">const</span> <a class="code" href="classdrwnTableFactor.html">drwnTableFactor</a> *A, <span class="keyword">const</span> <a class="code" href="classdrwnTableFactor.html">drwnTableFactor</a> *B) :</div><div class="line">    _result(result), _A(A), _B(B)</div><div class="line">{</div><div class="line">    <a class="code" href="drwnGraphUtils_8h.html#ac3389347747a969c542b347ddbf28d87">drwnClique</a> c;</div><div class="line">    c.insert(_A-&gt;getOrderedVars().begin(), _A-&gt;getOrderedVars().end());</div><div class="line">    c.insert(_B-&gt;getOrderedVars().begin(), _B-&gt;getOrderedVars().end());</div><div class="line">    vector&lt;int&gt; vars(c.begin(), c.end());</div><div class="line"></div><div class="line">    _mappingA = <a class="code" href="classdrwnTableFactorMapping.html">drwnTableFactorMapping</a>(vars, _A-&gt;getOrderedVars(), _A-&gt;getUniverse());</div><div class="line">    _mappingB = <a class="code" href="classdrwnTableFactorMapping.html">drwnTableFactorMapping</a>(vars, _B-&gt;getOrderedVars(), _B-&gt;getUniverse());</div><div class="line">}</div></div><!-- fragment --><p>The <code>execute</code> method performs the dot-product operation. In our case its behaviour is to virtually expand each factor to be over the full label space of the union of variables by replicating entries. It then sums the product of corresponding entries in these two virtual factors.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> DotProductOp::execute()</div><div class="line">{</div><div class="line">    <a class="code" href="classdrwnTableFactorMapping_1_1iterator.html">drwnTableFactorMapping::iterator</a> ia(_mappingA.begin());</div><div class="line">    <a class="code" href="classdrwnTableFactorMapping_1_1iterator.html">drwnTableFactorMapping::iterator</a> ib(_mappingB.<a class="code" href="classdrwnTableFactorMapping.html#a0db4420b8ce55b295adf868713e6e974">begin</a>());</div><div class="line">    *_result = 0.0;</div><div class="line">    <span class="keywordflow">while</span> (ia != _mappingA.end()) {</div><div class="line">        *_result += (*_A)[*ia++] * (*_B)[*ib++];</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><p>The following <code>main()</code> function shows example invocations of the the DotProduct class. The <code>tutorial</code> project contains a more elaborate example.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">    <span class="comment">// define variables</span></div><div class="line">    <a class="code" href="classdrwnSmartPointer.html">drwnVarUniversePtr</a> universe(<span class="keyword">new</span> <a class="code" href="classdrwnVarUniverse.html">drwnVarUniverse</a>());</div><div class="line">    universe-&gt;addVariable(3, <span class="stringliteral">&quot;a&quot;</span>);</div><div class="line">    universe-&gt;addVariable(3, <span class="stringliteral">&quot;b&quot;</span>);</div><div class="line"></div><div class="line">    <span class="comment">// dot-product between unary and pairwise factors</span></div><div class="line">    <a class="code" href="classdrwnTableFactor.html">drwnTableFactor</a> psiA(universe);</div><div class="line">    psiA.addVariable(<span class="stringliteral">&quot;a&quot;</span>);</div><div class="line">    psiA[0] = -1.0; psiA[1] = 0.0; psiA[2] = 1.0;</div><div class="line"></div><div class="line">    <a class="code" href="classdrwnTableFactor.html">drwnTableFactor</a> psiB(universe);</div><div class="line">    psiB.addVariable(<span class="stringliteral">&quot;b&quot;</span>);</div><div class="line">    psiB[0] = 1.0; psiB[1] = 0.0; psiB[2] = 0.0;</div><div class="line"></div><div class="line">    <a class="code" href="classdrwnTableFactor.html">drwnTableFactor</a> psiAB(universe);</div><div class="line">    psiAB.addVariables(<span class="stringliteral">&quot;b&quot;</span>, <span class="stringliteral">&quot;a&quot;</span>, NULL);</div><div class="line"></div><div class="line">    psiAB[0] = 1.0; psiAB[1] = 2.0; psiAB[2] = 3.0;</div><div class="line">    psiAB[3] = 4.0; psiAB[4] = 5.0; psiAB[5] = 6.0;</div><div class="line">    psiAB[6] = 7.0; psiAB[7] = 8.0; psiAB[8] = 9.0;</div><div class="line"></div><div class="line">    <span class="keywordtype">double</span> result;</div><div class="line">    DotProductOp(&amp;result, &amp;psiAB, &amp;psiA2).execute();</div><div class="line">    DRWN_LOG_MESSAGE(<span class="stringliteral">&quot;dot-product between A,B:[1 2 3; 4 5 6; 7 8 9] and A:[-1 0 1] is &quot;</span> &lt;&lt; result);</div><div class="line"></div><div class="line">    DotProductOp(&amp;result, &amp;psiAB, &amp;psiB).execute();</div><div class="line">    DRWN_LOG_MESSAGE(<span class="stringliteral">&quot;dot-product between A,B:[1 2 3; 4 5 6; 7 8 9] and B:[1 0 0] is &quot;</span> &lt;&lt; result);</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><dl class="section see"><dt>See also</dt><dd><a class="el" href="group__drwnBase.html">drwnBase</a>, <a class="el" href="group__drwnIO.html">drwnIO</a>, <a class="el" href="group__drwnPGM.html">drwnPGM</a></dd></dl>
<h2><a class="anchor" id="drwnTutorialSharedStorage"></a>
Shared Factor Storage</h2>
<p>Sometimes the same values appear in many different factors (i.e., over different variables) or factors are used to store temporary results at different times in the execution of an algorithm. In these situations the <a class="el" href="classdrwnTableFactorStorage.html" title="Shared memory for table factors. ">drwnTableFactorStorage</a> class can be used to reduce memory footprint and limit repeated memory allocations and deallocation. The following code snippet provides a simple example of sharing values in many factors.</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> N = 10;</div><div class="line"><a class="code" href="classdrwnSmartPointer.html">drwnVarUniversePtr</a> universe(<span class="keyword">new</span> <a class="code" href="classdrwnVarUniverse.html">drwnVarUniverse</a>(N, 2));</div><div class="line"></div><div class="line"><a class="code" href="classdrwnFactorGraph.html">drwnFactorGraph</a> graph;</div><div class="line"><a class="code" href="classdrwnTableFactorStorage.html">drwnTableFactorStorage</a> storage;</div><div class="line"></div><div class="line"><span class="comment">// add factors with shared storage</span></div><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; N - 1; i++) {</div><div class="line">    <a class="code" href="classdrwnTableFactor.html">drwnTableFactor</a> *psi = <span class="keyword">new</span> <a class="code" href="classdrwnTableFactor.html">drwnTableFactor</a>(universe, &amp;storage);</div><div class="line">    psi-&gt;<a class="code" href="classdrwnTableFactor.html#aabf14071ae5c0cb5031918b82f17e650">addVariable</a>(i);</div><div class="line">    psi-&gt;<a class="code" href="classdrwnTableFactor.html#aabf14071ae5c0cb5031918b82f17e650">addVariable</a>(i + 1);</div><div class="line">    graph.<a class="code" href="classdrwnFactorGraph.html#a9e0c66a976835c4d6267634b594e0976">addFactor</a>(psi);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// populate shared storage</span></div><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; storage.<a class="code" href="classdrwnTableFactorStorage.html#a1827d5a600005a5b992b106c301578eb">capacity</a>(); i++) {</div><div class="line">    storage[i] = drand48();</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// show factor graph</span></div><div class="line">graph.<a class="code" href="classdrwnWriteable.html#abe836316bc4b43a28f820a9978c80918">dump</a>();</div></div><!-- fragment --><dl class="section warning"><dt>Warning</dt><dd>A factor that is produced as the output of an operation should not use the same shared storage as any of the input factors as this may result in memory corruption.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__drwnBase.html">drwnBase</a>, <a class="el" href="group__drwnIO.html">drwnIO</a>, <a class="el" href="group__drwnPGM.html">drwnPGM</a></dd></dl>
<h1><a class="anchor" id="drwnTutorialWhereNext"></a>
Where next?</h1>
<p>You are now ready to start your own project using <b>Darwin</b> or explore some of the existing applications and projects. If you are interested in contributing to the library email <a href="#" onclick="location.href='mai'+'lto:'+'ste'+'ph'+'en.'+'go'+'uld'+'@a'+'nu.'+'ed'+'u.a'+'u'; return false;">steph<span style="display: none;">.nosp@m.</span>en.g<span style="display: none;">.nosp@m.</span>ould@<span style="display: none;">.nosp@m.</span>anu.<span style="display: none;">.nosp@m.</span>edu.a<span style="display: none;">.nosp@m.</span>u</a>.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="codingGuidelines.html">Coding Guidelines</a> </dd>
<dd>
<a class="el" href="drwnApplications.html">Applications and Project Descriptions</a> </dd></dl>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed May 7 2025 09:52:24 for Darwin by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
